{"addedFiles":{},"deletedFiles":{},"modifiedFiles":{"before":{"packages/@uppy/aws-s3/src/MultipartUploader.ts":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"module","interpreter":null,"body":[{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Uppy"},"importKind":"value","local":{"type":"Identifier","name":"Uppy"}}],"source":{"type":"StringLiteral","value":"@uppy/core"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"AbortController"},"importKind":"value","local":{"type":"Identifier","name":"AbortController"}}],"source":{"type":"StringLiteral","value":"@uppy/utils/lib/AbortController"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Meta"},"importKind":"value","local":{"type":"Identifier","name":"Meta"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"UppyFile"},"importKind":"value","local":{"type":"Identifier","name":"UppyFile"}}],"source":{"type":"StringLiteral","value":"@uppy/utils/lib/UppyFile"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"HTTPCommunicationQueue"},"importKind":"value","local":{"type":"Identifier","name":"HTTPCommunicationQueue"}}],"source":{"type":"StringLiteral","value":"./HTTPCommunicationQueue.js"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Body"},"importKind":"value","local":{"type":"Identifier","name":"Body"}}],"source":{"type":"StringLiteral","value":"./utils.js"}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"MB"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1024},"operator":"*","right":{"type":"NumericLiteral","value":1024}}}],"kind":"const"},{"type":"TSInterfaceDeclaration","id":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"M","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Meta"}}},{"type":"TSTypeParameter","name":"B","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}}]},"body":{"type":"TSInterfaceBody","body":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"getChunkSize"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"size"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}]}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onProgress"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"bytesUploaded","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"Identifier","name":"bytesTotal","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onPartComplete"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"part","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"PartNumber"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"ETag"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}]}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnionType","types":[{"type":"TSBooleanKeyword"},{"type":"TSParenthesizedType","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}}]}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onSuccess"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"result","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onError"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"companionComm"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"HTTPCommunicationQueue"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"file"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"log"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIndexedAccessType","objectType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Uppy"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},"indexType":{"type":"TSLiteralType","literal":{"type":"StringLiteral","value":"log"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"uploadId"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"key"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"defaultOptions"},"init":{"type":"TSSatisfiesExpression","expression":{"type":"ObjectExpression","properties":[{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"getChunkSize"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"size"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}]}}}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"ceil"}},"arguments":[{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"size"}},"operator":"/","right":{"type":"NumericLiteral","value":10000}}]}}],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onPartComplete"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onSuccess"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onError"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"BlockStatement","body":[{"type":"ThrowStatement","argument":{"type":"Identifier","name":"err"}}],"directives":[]}}]},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Partial"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}]}}}}],"kind":"const"},{"type":"ExportNamedDeclaration","exportKind":"type","specifiers":[],"source":null,"declaration":{"type":"TSInterfaceDeclaration","id":{"type":"Identifier","name":"Chunk"},"body":{"type":"TSInterfaceBody","body":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"getData"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onProgress"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"ev","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"ProgressEvent"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onComplete"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"etag","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"setAsUploaded"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}}]}}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"ensureInt"},"generator":false,"async":false,"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"T"}]},"params":[{"type":"Identifier","name":"value","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"T"}}}}],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSConditionalType","checkType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"T"}},"extendsType":{"type":"TSUnionType","types":[{"type":"TSNumberKeyword"},{"type":"TSStringKeyword"}]},"trueType":{"type":"TSNumberKeyword"},"falseType":{"type":"TSNeverKeyword"}}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"Identifier","name":"value"}},"operator":"===","right":{"type":"StringLiteral","value":"string"}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"parseInt"},"arguments":[{"type":"Identifier","name":"value"},{"type":"NumericLiteral","value":10}]}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"Identifier","name":"value"}},"operator":"===","right":{"type":"StringLiteral","value":"number"}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"Identifier","name":"value"}}],"directives":[]},"alternate":null},{"type":"ThrowStatement","argument":{"type":"NewExpression","callee":{"type":"Identifier","name":"TypeError"},"arguments":[{"type":"StringLiteral","value":"Expected a number"}]}}],"directives":[]}},{"type":"ExportNamedDeclaration","exportKind":"value","specifiers":[],"source":null,"declaration":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"pausingUploadReason"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"Symbol"},"arguments":[{"type":"StringLiteral","value":"pausing upload, not an actual error"}]}}],"kind":"const"}},{"type":"ClassDeclaration","id":{"type":"Identifier","name":"MultipartUploader"},"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"M","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Meta"}}},{"type":"TSTypeParameter","name":"B","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}}]},"superClass":null,"body":{"type":"ClassBody","body":[{"type":"ClassProperty","static":false,"key":{"type":"Identifier","name":"options"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIntersectionType","types":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Required"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Pick"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},{"type":"TSTypeOperator","operator":"keyof","typeAnnotation":{"type":"TSTypeQuery","exprName":{"type":"Identifier","name":"defaultOptions"}}}]}}]}}]}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}},"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Array"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSUnionType","types":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Chunk"}},{"type":"TSNullKeyword"}]}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSArrayType","elementType":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"uploaded"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"etag"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"done"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}},"value":{"type":"BooleanLiteral","value":false}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"result","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIndexedAccessType","objectType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},"indexType":{"type":"TSLiteralType","literal":{"type":"StringLiteral","value":"shouldUseMultipart"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"OptionalMemberExpression","object":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"err"},"typeAnnotation":{"type":"TSAnyKeyword"}},"computed":false,"property":{"type":"Identifier","name":"cause"},"optional":true},"operator":"===","right":{"type":"Identifier","name":"pausingUploadReason"}},"consequent":{"type":"NullLiteral"},"alternate":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}}},"arguments":[{"type":"Identifier","name":"err"}]}}}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}},"value":{"type":"NumericLiteral","value":10000}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}},"value":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"constructor"},"computed":false,"kind":"constructor","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"data","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}}},{"type":"Identifier","name":"options","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"defaultOptions"}},{"type":"SpreadElement","argument":{"type":"Identifier","name":"options"}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"??=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"defaultOptions"},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"right":{"type":"Identifier","name":"data"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"file"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onSuccess"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onError"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"shouldUseMultipart"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"right":{"type":"TSAsExpression","expression":{"type":"TSAsExpression","expression":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"uploadId"}},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"key"}}},"typeAnnotation":{"type":"TSAnyKeyword"}},"typeAnnotation":{"type":"TSBooleanKeyword"}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"initChunks"}}},"arguments":[]}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"initChunks"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"size"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"shouldUseMultipart"},"init":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}}},"operator":"===","right":{"type":"StringLiteral","value":"function"}},"consequent":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}}]},"alternate":{"type":"CallExpression","callee":{"type":"Identifier","name":"Boolean"},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}}]}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"Identifier","name":"shouldUseMultipart"},"operator":"&&","right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":">","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}}}}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"chunkSize"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"max"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}}]},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}}}]}}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"arraySize"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"floor"}},"arguments":[{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"/","right":{"type":"Identifier","name":"chunkSize"}}]}}],"kind":"let"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"arraySize"},"operator":">","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"arraySize"},"right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"chunkSize"},"right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"/","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}}}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"Array"},"arguments":[{"type":"Identifier","name":"arraySize"}]}}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"offset"},"init":{"type":"NumericLiteral","value":0}},{"type":"VariableDeclarator","id":{"type":"Identifier","name":"j"},"init":{"type":"NumericLiteral","value":0}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"<","right":{"type":"Identifier","name":"fileSize"}},"update":{"type":"SequenceExpression","expressions":[{"type":"AssignmentExpression","operator":"+=","left":{"type":"Identifier","name":"offset"},"right":{"type":"Identifier","name":"chunkSize"}},{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"j"}}]},"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"end"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"min"}},"arguments":[{"type":"Identifier","name":"fileSize"},{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"+","right":{"type":"Identifier","name":"chunkSize"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getData"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i2"},"init":{"type":"Identifier","name":"offset"}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"slice"}},"arguments":[{"type":"Identifier","name":"i2"},{"type":"Identifier","name":"end"}]}}],"directives":[]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getData"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"getData"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}}},"arguments":[{"type":"Identifier","name":"j"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onComplete"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}}},"arguments":[{"type":"Identifier","name":"j"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"shouldUseMultipart"}}]}}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"size"},"init":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"+","right":{"type":"Identifier","name":"chunkSize"}},"operator":">","right":{"type":"Identifier","name":"fileSize"}},"consequent":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"-","right":{"type":"Identifier","name":"offset"}},"alternate":{"type":"Identifier","name":"chunkSize"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}}},"computed":false,"property":{"type":"Identifier","name":"setAsUploaded"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"right":{"type":"NullLiteral"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"computed":false,"property":{"type":"Identifier","name":"uploaded"}},"right":{"type":"Identifier","name":"size"}}}],"directives":[]}}}}],"directives":[]},"alternate":null}],"directives":[]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"right":{"type":"ArrayExpression","elements":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getData"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}}},"arguments":[{"type":"NumericLiteral","value":0}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onComplete"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}}},"arguments":[{"type":"NumericLiteral","value":0}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"shouldUseMultipart"}}]}]}}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploaded"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}}]}}]}}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"createUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"uploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"TSAsExpression","expression":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"typeAnnotation":{"type":"TSArrayType","elementType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Chunk"}}}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}}]},"computed":false,"property":{"type":"Identifier","name":"then"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}}}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}}},"right":{"type":"BooleanLiteral","value":true}}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"resumeUploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}}]},"computed":false,"property":{"type":"Identifier","name":"then"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}}}]}}],"directives":[]}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"index","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"ev","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"ProgressEvent"}}}}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"ev"},"computed":false,"property":{"type":"Identifier","name":"lengthComputable"}}},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"uploaded"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"ensureInt"},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"ev"},"computed":false,"property":{"type":"Identifier","name":"loaded"}}]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"totalUploaded"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":false,"property":{"type":"Identifier","name":"reduce"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"n"},{"type":"Identifier","name":"c"}],"body":{"type":"BinaryExpression","left":{"type":"Identifier","name":"n"},"operator":"+","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"c"},"computed":false,"property":{"type":"Identifier","name":"uploaded"}}}},{"type":"NumericLiteral","value":0}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onProgress"}},"arguments":[{"type":"Identifier","name":"totalUploaded"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"size"}}]}}],"directives":[]}}}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"index","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"etag","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"right":{"type":"NullLiteral"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"etag"}},"right":{"type":"Identifier","name":"etag"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"done"}},"right":{"type":"BooleanLiteral","value":true}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"part"},"init":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"PartNumber"},"computed":false,"shorthand":false,"value":{"type":"BinaryExpression","left":{"type":"Identifier","name":"index"},"operator":"+","right":{"type":"NumericLiteral","value":1}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"etag"}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onPartComplete"}},"arguments":[{"type":"Identifier","name":"part"}]}}],"directives":[]}}}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"abortUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"abortFileUpload"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}}]},"computed":false,"property":{"type":"Identifier","name":"catch"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"log"}},"arguments":[{"type":"TSAsExpression","expression":{"type":"Identifier","name":"err"},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Error"}}}]}}]}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"start"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}}},"consequent":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}},"computed":false,"property":{"type":"Identifier","name":"aborted"}}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[{"type":"Identifier","name":"pausingUploadReason"}]}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}}},"arguments":[]}}],"directives":[]},"alternate":{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"restoreUploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"uploadId"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}}},"arguments":[]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"createUpload"}}},"arguments":[]}}],"directives":[]}}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"pause"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[{"type":"Identifier","name":"pausingUploadReason"}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"abort"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"opts","optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"really"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}]}}}],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"opts"},"computed":false,"property":{"type":"Identifier","name":"really"},"optional":true},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortUpload"}}},"arguments":[]}},"alternate":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"pause"}},"arguments":[]}}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"chunkState"},"computed":false,"kind":"get","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}}}],"directives":[]}}]}},{"type":"ExportDefaultDeclaration","exportKind":"value","declaration":{"type":"Identifier","name":"MultipartUploader"}}],"directives":[]}},"packages/@uppy/aws-s3/src/index.test.ts":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"module","interpreter":null,"body":[{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"afterEach"},"importKind":"value","local":{"type":"Identifier","name":"afterEach"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"beforeEach"},"importKind":"value","local":{"type":"Identifier","name":"beforeEach"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"describe"},"importKind":"value","local":{"type":"Identifier","name":"describe"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"expect"},"importKind":"value","local":{"type":"Identifier","name":"expect"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"it"},"importKind":"value","local":{"type":"Identifier","name":"it"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"vi"},"importKind":"value","local":{"type":"Identifier","name":"vi"}}],"source":{"type":"StringLiteral","value":"vitest"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[],"source":{"type":"StringLiteral","value":"whatwg-fetch"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"nock"}}],"source":{"type":"StringLiteral","value":"nock"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"Core"}}],"source":{"type":"StringLiteral","value":"@uppy/core"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"AwsS3Multipart"}}],"source":{"type":"StringLiteral","value":"./index.ts"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Body"},"importKind":"value","local":{"type":"Identifier","name":"Body"}}],"source":{"type":"StringLiteral","value":"./utils.js"}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"KB"},"init":{"type":"NumericLiteral","value":1024}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"MB"},"init":{"type":"BinaryExpression","left":{"type":"Identifier","name":"KB"},"operator":"*","right":{"type":"Identifier","name":"KB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"nock"},"computed":false,"property":{"type":"Identifier","name":"disableNetConnect"}},"arguments":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Registers AwsS3Multipart upload plugin"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"pluginNames"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getPlugins"}]}},"arguments":[{"type":"StringLiteral","value":"uploader"}]},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"plugin","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}}],"body":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"plugin"},"computed":false,"property":{"type":"Identifier","name":"constructor"}},"computed":false,"property":{"type":"Identifier","name":"name"}}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"pluginNames"}]},"computed":false,"property":{"type":"Identifier","name":"toContain"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"companionUrl assertion"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Throws an error for main functions if configured without companionUrl"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"err"},"init":{"type":"StringLiteral","value":"Expected a `companionUrl` option"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"file"},"init":{"type":"ObjectExpression","properties":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"opts"},"init":{"type":"ObjectExpression","properties":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"listParts"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"completeMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"abortMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"non-multipart upload"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"should handle POST uploads"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"limit"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getUploadParameters"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"POST"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com/"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"fields"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[]}}]}}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"scope"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"POST"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag, Location"}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"options"}},"arguments":[{"type":"StringLiteral","value":"/"}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":204},{"type":"StringLiteral","value":""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/"}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":201},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"Location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"NumericLiteral","value":1}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uploadSuccessHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"upload-success"},{"type":"Identifier","name":"uploadSuccessHandler"}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadSuccessHandler"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}}]},"computed":false,"property":{"type":"Identifier","name":"toHaveLength"}},"arguments":[{"type":"NumericLiteral","value":1}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadSuccessHandler"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":true,"property":{"type":"NumericLiteral","value":0}},"computed":true,"property":{"type":"NumericLiteral","value":1}}]},"computed":false,"property":{"type":"Identifier","name":"toStrictEqual"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"body"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":200}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadURL"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"done"}},"arguments":[]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"without companionUrl (custom main functions)"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"limit"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"Identifier","name":"file"},{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"number"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"number"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"number"}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"headers"},"computed":false,"shorthand":false,"value":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"number"},"operator":"===","right":{"type":"NumericLiteral","value":1}},"consequent":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"Content-MD5"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"foo"}}]},"alternate":{"type":"Identifier","name":"undefined"}}}]}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSAnyKeyword"}}}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Keeps chunks marked as busy through retries until they complete"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"scope"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"options"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]},"operator":"&&","right":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"partNumber=7"}]}}}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"calls"},"init":{"type":"NumericLiteral","value":0}}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]},"operator":"&&","right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"partNumber=7"}]}}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"calls"}},"operator":"===","right":{"type":"NumericLiteral","value":0}},"consequent":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":500}]},"alternate":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]}}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"busySpy"},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"doneSpy"},"init":null}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"retryDelays"},"computed":false,"shorthand":false,"value":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":10}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"multipartUploader"},"init":{"type":"TSNonNullExpression","expression":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"uploaders"}},"computed":true,"property":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"testChunkState"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"multipartUploader"},"computed":false,"property":{"type":"Identifier","name":"chunkState"}},"computed":true,"property":{"type":"NumericLiteral","value":6}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"busy"},"init":{"type":"BooleanLiteral","value":false}}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"done"},"init":{"type":"BooleanLiteral","value":false}}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"busySpy"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"busy"},"right":{"type":"Identifier","name":"value"}}}],"directives":[]}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"doneSpy"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"done"},"right":{"type":"Identifier","name":"value"}}}],"directives":[]}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"defineProperty"}},"arguments":[{"type":"Identifier","name":"testChunkState"},{"type":"StringLiteral","value":"busy"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"get"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"Identifier","name":"busy"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"set"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"busySpy"}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"defineProperty"}},"arguments":[{"type":"Identifier","name":"testChunkState"},{"type":"StringLiteral","value":"done"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"get"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"Identifier","name":"done"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"set"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"doneSpy"}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":1}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":true,"property":{"type":"NumericLiteral","value":0}},"computed":true,"property":{"type":"NumericLiteral","value":0}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"doneCallOrderNumber"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"invocationCallOrder"}},"computed":true,"property":{"type":"NumericLiteral","value":0}}}],"kind":"const"},{"type":"ForOfStatement","await":false,"left":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ArrayPattern","elements":[{"type":"Identifier","name":"index"},{"type":"Identifier","name":"callArgs"}]},"init":null}],"kind":"const"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"busySpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"entries"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"callArgs"},"computed":true,"property":{"type":"NumericLiteral","value":0}},"operator":"===","right":{"type":"BooleanLiteral","value":false}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"busySpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"invocationCallOrder"}},"computed":true,"property":{"type":"Identifier","name":"index"}}]},"computed":false,"property":{"type":"Identifier","name":"toBeGreaterThan"}},"arguments":[{"type":"Identifier","name":"doneCallOrderNumber"}]}}],"directives":[]},"alternate":null}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSAsExpression","expression":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"typeAnnotation":{"type":"TSAnyKeyword"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":10}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"MultipartUploader"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPart"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"Identifier","name":"file"},{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"partNumber"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"partNumber"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"partNumber"}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uploadPartBytes"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"afterEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"clearAllMocks"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"retries uploadPartBytes when it fails once"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ThrowStatement","argument":{"type":"StringLiteral","value":"should ignore"}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"property":{"type":"Identifier","name":"mockImplementationOnce"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Promise"},"computed":false,"property":{"type":"Identifier","name":"reject"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}},"operator":"+","right":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1},"operator":"*","right":{"type":"Identifier","name":"MB"}}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"uploadPartBytes"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":3}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"calls `upload-error` when uploadPartBytes fails after all retries"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"retryDelays"},"computed":false,"shorthand":false,"value":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":10}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"property":{"type":"Identifier","name":"mockImplementation"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Promise"},"computed":false,"property":{"type":"Identifier","name":"reject"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}},"operator":"+","right":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1},"operator":"*","right":{"type":"Identifier","name":"MB"}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"mock"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"upload-error"},{"type":"Identifier","name":"mock"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}]},"computed":false,"property":{"type":"Identifier","name":"rejects"}},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"uploadPartBytes"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":3}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"mock"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":1}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"dynamic companionHeader"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oldToken"},"init":{"type":"StringLiteral","value":"old token"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"newToken"},"init":{"type":"StringLiteral","value":"new token"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionUrl"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":""}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"oldToken"}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSAnyKeyword"}}}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"companionHeader is updated before uploading file"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"newToken"}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"client"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getClient"}]}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"client"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getCompanionHeaders"}]}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"authorization"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"Identifier","name":"newToken"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"dynamic companionHeader using setOption"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"newToken"},"init":{"type":"StringLiteral","value":"new token"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"companionHeader is updated before uploading file"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addPreProcessor"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"newToken"}}]}}]}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"client"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getClient"}]}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"client"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getCompanionHeaders"}]}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"authorization"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"Identifier","name":"newToken"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"file metadata across custom main functions"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"upload1234"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"name"}}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPart"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"listParts"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"partKeys"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}]},"computed":false,"property":{"type":"Identifier","name":"filter"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"metaKey"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"metaKey"},"computed":false,"property":{"type":"Identifier","name":"startsWith"}},"arguments":[{"type":"StringLiteral","value":"part"}]}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"partKeys"},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"metaKey"}],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"PartNumber"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"Identifier","name":"metaKey"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"metaKey"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"Size"},"computed":false,"shorthand":false,"value":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}}}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"completeMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i"},"init":{"type":"NumericLiteral","value":1}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"i"},"operator":"<=","right":{"type":"NumericLiteral","value":10}},"update":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"i"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"i"}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"Identifier","name":"i"}]}}],"directives":[]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"abortMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"abortingPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"NumericLiteral","value":5}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"signPart"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"listParts"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is completed"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"completeMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPart"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalledTimes"}},"arguments":[{"type":"NumericLiteral","value":11}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"completeMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is aborted"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPartWithAbort"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}},"operator":"===","right":{"type":"NumericLiteral","value":5}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortingPart"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"removeFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}},"typeAnnotation":{"type":"TSStringKeyword"}}}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"signPartWithAbort"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"completeMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPartWithAbort"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"abortMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is paused and resumed"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"completeMultipartUploadAfterPause"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i"},"init":{"type":"NumericLiteral","value":1}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"i"},"operator":"<=","right":{"type":"NumericLiteral","value":10}},"update":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"i"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"i"}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"Identifier","name":"i"}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"listParts"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPartWithPause"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}},"operator":"===","right":{"type":"NumericLiteral","value":3}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortingPart"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"pauseResume"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"setTimeout"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"pauseResume"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"NumericLiteral","value":500}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"signPartWithPause"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"completeMultipartUploadAfterPause"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPartWithPause"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"listParts"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"completeMultipartUploadAfterPause"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}}],"directives":[]}}]}}],"directives":[]}}]}}],"directives":[]}}},"after":{"packages/@uppy/aws-s3/src/MultipartUploader.ts":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"module","interpreter":null,"body":[{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Uppy"},"importKind":"value","local":{"type":"Identifier","name":"Uppy"}}],"source":{"type":"StringLiteral","value":"@uppy/core"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"AbortController"},"importKind":"value","local":{"type":"Identifier","name":"AbortController"}}],"source":{"type":"StringLiteral","value":"@uppy/utils/lib/AbortController"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Meta"},"importKind":"value","local":{"type":"Identifier","name":"Meta"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"UppyFile"},"importKind":"value","local":{"type":"Identifier","name":"UppyFile"}}],"source":{"type":"StringLiteral","value":"@uppy/utils/lib/UppyFile"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"HTTPCommunicationQueue"},"importKind":"value","local":{"type":"Identifier","name":"HTTPCommunicationQueue"}}],"source":{"type":"StringLiteral","value":"./HTTPCommunicationQueue.js"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Body"},"importKind":"value","local":{"type":"Identifier","name":"Body"}}],"source":{"type":"StringLiteral","value":"./utils.js"}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"MB"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1024},"operator":"*","right":{"type":"NumericLiteral","value":1024}}}],"kind":"const"},{"type":"TSInterfaceDeclaration","id":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"M","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Meta"}}},{"type":"TSTypeParameter","name":"B","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}}]},"body":{"type":"TSInterfaceBody","body":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"getChunkSize"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"size"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}]}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onProgress"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"bytesUploaded","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"Identifier","name":"bytesTotal","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onPartComplete"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"part","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"PartNumber"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"ETag"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}]}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnionType","types":[{"type":"TSBooleanKeyword"},{"type":"TSParenthesizedType","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}}]}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onSuccess"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"result","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onError"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"companionComm"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"HTTPCommunicationQueue"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"file"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"log"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIndexedAccessType","objectType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Uppy"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},"indexType":{"type":"TSLiteralType","literal":{"type":"StringLiteral","value":"log"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"uploadId"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"key"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"defaultOptions"},"init":{"type":"TSSatisfiesExpression","expression":{"type":"ObjectExpression","properties":[{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"getChunkSize"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"size"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}]}}}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"ceil"}},"arguments":[{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"size"}},"operator":"/","right":{"type":"NumericLiteral","value":10000}}]}}],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onPartComplete"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onSuccess"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[],"directives":[]}},{"type":"ObjectMethod","method":true,"key":{"type":"Identifier","name":"onError"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"BlockStatement","body":[{"type":"ThrowStatement","argument":{"type":"Identifier","name":"err"}}],"directives":[]}}]},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Partial"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}]}}}}],"kind":"const"},{"type":"ExportNamedDeclaration","exportKind":"type","specifiers":[],"source":null,"declaration":{"type":"TSInterfaceDeclaration","id":{"type":"Identifier","name":"Chunk"},"body":{"type":"TSInterfaceBody","body":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"getData"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onProgress"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"ev","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"ProgressEvent"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"onComplete"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"etag","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"setAsUploaded"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}}}]}}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"ensureInt"},"generator":false,"async":false,"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"T"}]},"params":[{"type":"Identifier","name":"value","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"T"}}}}],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSConditionalType","checkType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"T"}},"extendsType":{"type":"TSUnionType","types":[{"type":"TSNumberKeyword"},{"type":"TSStringKeyword"}]},"trueType":{"type":"TSNumberKeyword"},"falseType":{"type":"TSNeverKeyword"}}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"Identifier","name":"value"}},"operator":"===","right":{"type":"StringLiteral","value":"string"}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"parseInt"},"arguments":[{"type":"Identifier","name":"value"},{"type":"NumericLiteral","value":10}]}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"Identifier","name":"value"}},"operator":"===","right":{"type":"StringLiteral","value":"number"}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"Identifier","name":"value"}}],"directives":[]},"alternate":null},{"type":"ThrowStatement","argument":{"type":"NewExpression","callee":{"type":"Identifier","name":"TypeError"},"arguments":[{"type":"StringLiteral","value":"Expected a number"}]}}],"directives":[]}},{"type":"ExportNamedDeclaration","exportKind":"value","specifiers":[],"source":null,"declaration":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"pausingUploadReason"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"Symbol"},"arguments":[{"type":"StringLiteral","value":"pausing upload, not an actual error"}]}}],"kind":"const"}},{"type":"ClassDeclaration","id":{"type":"Identifier","name":"MultipartUploader"},"typeParameters":{"type":"TSTypeParameterDeclaration","params":[{"type":"TSTypeParameter","name":"M","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Meta"}}},{"type":"TSTypeParameter","name":"B","constraint":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}}]},"superClass":null,"body":{"type":"ClassBody","body":[{"type":"ClassProperty","static":false,"key":{"type":"Identifier","name":"options"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIntersectionType","types":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Required"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Pick"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},{"type":"TSTypeOperator","operator":"keyof","typeAnnotation":{"type":"TSTypeQuery","exprName":{"type":"Identifier","name":"defaultOptions"}}}]}}]}}]}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}},"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Array"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSUnionType","types":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Chunk"}},{"type":"TSNullKeyword"}]}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSArrayType","elementType":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"uploaded"},"computed":false,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"etag"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}},{"type":"TSPropertySignature","key":{"type":"Identifier","name":"done"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"UppyFile"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}},"value":{"type":"BooleanLiteral","value":false}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSFunctionType","parameters":[{"type":"Identifier","name":"result","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}}}],"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSIndexedAccessType","objectType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}},"indexType":{"type":"TSLiteralType","literal":{"type":"StringLiteral","value":"shouldUseMultipart"}}}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}},"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}},"value":null},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"OptionalMemberExpression","object":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"err"},"typeAnnotation":{"type":"TSAnyKeyword"}},"computed":false,"property":{"type":"Identifier","name":"cause"},"optional":true},"operator":"===","right":{"type":"Identifier","name":"pausingUploadReason"}},"consequent":{"type":"NullLiteral"},"alternate":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}}},"arguments":[{"type":"Identifier","name":"err"}]}}}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}},"value":{"type":"NumericLiteral","value":10000}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}},"value":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"constructor"},"computed":false,"kind":"constructor","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"data","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Blob"}}}},{"type":"Identifier","name":"options","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"MultipartUploaderOptions"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"M"}},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"B"}}]}}}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"defaultOptions"}},{"type":"SpreadElement","argument":{"type":"Identifier","name":"options"}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"??=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"defaultOptions"},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"right":{"type":"Identifier","name":"data"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"file"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onSuccess"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onError"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onError"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"shouldUseMultipart"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"right":{"type":"TSAsExpression","expression":{"type":"TSAsExpression","expression":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"uploadId"}},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"key"}}},"typeAnnotation":{"type":"TSAnyKeyword"}},"typeAnnotation":{"type":"TSBooleanKeyword"}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"initChunks"}}},"arguments":[]}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"initChunks"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"size"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"shouldUseMultipart"},"init":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}}},"operator":"===","right":{"type":"StringLiteral","value":"function"}},"consequent":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}}]},"alternate":{"type":"CallExpression","callee":{"type":"Identifier","name":"Boolean"},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"shouldUseMultipart"}}}]}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"Identifier","name":"shouldUseMultipart"},"operator":"&&","right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":">","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}}}}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"chunkSize"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"max"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"getChunkSize"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}}]},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"minPartSize"}}}]}}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"arraySize"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"floor"}},"arguments":[{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"/","right":{"type":"Identifier","name":"chunkSize"}}]}}],"kind":"let"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"arraySize"},"operator":">","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"arraySize"},"right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"chunkSize"},"right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"/","right":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"maxMultipartParts"}}}}}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"Array"},"arguments":[{"type":"Identifier","name":"arraySize"}]}}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"offset"},"init":{"type":"NumericLiteral","value":0}},{"type":"VariableDeclarator","id":{"type":"Identifier","name":"j"},"init":{"type":"NumericLiteral","value":0}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"<","right":{"type":"Identifier","name":"fileSize"}},"update":{"type":"SequenceExpression","expressions":[{"type":"AssignmentExpression","operator":"+=","left":{"type":"Identifier","name":"offset"},"right":{"type":"Identifier","name":"chunkSize"}},{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"j"}}]},"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"end"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Math"},"computed":false,"property":{"type":"Identifier","name":"min"}},"arguments":[{"type":"Identifier","name":"fileSize"},{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"+","right":{"type":"Identifier","name":"chunkSize"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getData"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i2"},"init":{"type":"Identifier","name":"offset"}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"slice"}},"arguments":[{"type":"Identifier","name":"i2"},{"type":"Identifier","name":"end"}]}}],"directives":[]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getData"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"getData"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}}},"arguments":[{"type":"Identifier","name":"j"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onComplete"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}}},"arguments":[{"type":"Identifier","name":"j"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"shouldUseMultipart"}}]}}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"size"},"init":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"Identifier","name":"offset"},"operator":"+","right":{"type":"Identifier","name":"chunkSize"}},"operator":">","right":{"type":"Identifier","name":"fileSize"}},"consequent":{"type":"BinaryExpression","left":{"type":"Identifier","name":"fileSize"},"operator":"-","right":{"type":"Identifier","name":"offset"}},"alternate":{"type":"Identifier","name":"chunkSize"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}}},"computed":false,"property":{"type":"Identifier","name":"setAsUploaded"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"right":{"type":"NullLiteral"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"j"}},"computed":false,"property":{"type":"Identifier","name":"uploaded"}},"right":{"type":"Identifier","name":"size"}}}],"directives":[]}}}}],"directives":[]},"alternate":null}],"directives":[]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"right":{"type":"ArrayExpression","elements":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getData"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onProgress"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}}},"arguments":[{"type":"NumericLiteral","value":0}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onComplete"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}}},"arguments":[{"type":"NumericLiteral","value":0}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"shouldUseMultipart"}}]}]}}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploaded"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}}]}}]}}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"createUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"uploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"TSAsExpression","expression":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"typeAnnotation":{"type":"TSArrayType","elementType":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Chunk"}}}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}}]},"computed":false,"property":{"type":"Identifier","name":"then"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}}}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}}},"right":{"type":"BooleanLiteral","value":true}}}],"directives":[]}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"resumeUploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}}]},"computed":false,"property":{"type":"Identifier","name":"then"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onSuccess"}}},{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"onReject"}}}]}}],"directives":[]}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartProgress"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"index","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"ev","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"ProgressEvent"}}}}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"ev"},"computed":false,"property":{"type":"Identifier","name":"lengthComputable"}}},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"uploaded"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"ensureInt"},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"ev"},"computed":false,"property":{"type":"Identifier","name":"loaded"}}]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"totalUploaded"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":false,"property":{"type":"Identifier","name":"reduce"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"n"},{"type":"Identifier","name":"c"}],"body":{"type":"BinaryExpression","left":{"type":"Identifier","name":"n"},"operator":"+","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"c"},"computed":false,"property":{"type":"Identifier","name":"uploaded"}}}},{"type":"NumericLiteral","value":0}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onProgress"}},"arguments":[{"type":"Identifier","name":"totalUploaded"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"data"}}},"computed":false,"property":{"type":"Identifier","name":"size"}}]}}],"directives":[]}}}},{"type":"ClassPrivateProperty","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"onPartComplete"}},"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"index","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSNumberKeyword"}}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"etag","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSStringKeyword"}}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunks"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"right":{"type":"NullLiteral"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"etag"}},"right":{"type":"Identifier","name":"etag"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}},"computed":true,"property":{"type":"Identifier","name":"index"}},"computed":false,"property":{"type":"Identifier","name":"done"}},"right":{"type":"BooleanLiteral","value":true}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"part"},"init":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"PartNumber"},"computed":false,"shorthand":false,"value":{"type":"BinaryExpression","left":{"type":"Identifier","name":"index"},"operator":"+","right":{"type":"NumericLiteral","value":1}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"etag"}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"onPartComplete"}},"arguments":[{"type":"Identifier","name":"part"}]}}],"directives":[]}}}},{"type":"ClassPrivateMethod","static":false,"key":{"type":"PrivateName","id":{"type":"Identifier","name":"abortUpload"}},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"abortFileUpload"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}}]},"computed":false,"property":{"type":"Identifier","name":"catch"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSUnknownKeyword"}}}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"log"}},"arguments":[{"type":"TSAsExpression","expression":{"type":"Identifier","name":"err"},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Error"}}}]}}]}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"start"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"uploadHasStarted"}}},"consequent":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"signal"}},"computed":false,"property":{"type":"Identifier","name":"aborted"}}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[{"type":"Identifier","name":"pausingUploadReason"}]}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}}},"arguments":[]}}],"directives":[]},"alternate":{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"isRestoring"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"companionComm"}},"computed":false,"property":{"type":"Identifier","name":"restoreUploadFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"file"}}},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"uploadId"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"resumeUpload"}}},"arguments":[]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"createUpload"}}},"arguments":[]}}],"directives":[]}}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"pause"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"computed":false,"property":{"type":"Identifier","name":"abort"}},"arguments":[{"type":"Identifier","name":"pausingUploadReason"}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortController"}}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"AbortController"},"arguments":[]}}}],"directives":[]}},{"type":"ClassMethod","static":false,"key":{"type":"Identifier","name":"abort"},"computed":false,"kind":"method","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"opts","optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeLiteral","members":[{"type":"TSPropertySignature","key":{"type":"Identifier","name":"really"},"computed":false,"optional":true,"typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSBooleanKeyword"}}}]}}}],"returnType":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSVoidKeyword"}},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"opts"},"computed":false,"property":{"type":"Identifier","name":"really"},"optional":true},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"abortUpload"}}},"arguments":[]}},"alternate":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"Identifier","name":"pause"}},"arguments":[]}}}],"directives":[]}},{"type":"ClassMethod","accessibility":"private","static":false,"computed":true,"key":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getChunkState"}]},"kind":"method","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"MemberExpression","object":{"type":"ThisExpression"},"computed":false,"property":{"type":"PrivateName","id":{"type":"Identifier","name":"chunkState"}}}}],"directives":[]}}]}},{"type":"ExportDefaultDeclaration","exportKind":"value","declaration":{"type":"Identifier","name":"MultipartUploader"}}],"directives":[]}},"packages/@uppy/aws-s3/src/index.test.ts":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"module","interpreter":null,"body":[{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"afterEach"},"importKind":"value","local":{"type":"Identifier","name":"afterEach"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"beforeEach"},"importKind":"value","local":{"type":"Identifier","name":"beforeEach"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"describe"},"importKind":"value","local":{"type":"Identifier","name":"describe"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"expect"},"importKind":"value","local":{"type":"Identifier","name":"expect"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"it"},"importKind":"value","local":{"type":"Identifier","name":"it"}},{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"vi"},"importKind":"value","local":{"type":"Identifier","name":"vi"}}],"source":{"type":"StringLiteral","value":"vitest"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[],"source":{"type":"StringLiteral","value":"whatwg-fetch"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"nock"}}],"source":{"type":"StringLiteral","value":"nock"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"Core"}}],"source":{"type":"StringLiteral","value":"@uppy/core"}},{"type":"ImportDeclaration","importKind":"value","specifiers":[{"type":"ImportDefaultSpecifier","local":{"type":"Identifier","name":"AwsS3Multipart"}}],"source":{"type":"StringLiteral","value":"./index.ts"}},{"type":"ImportDeclaration","importKind":"type","specifiers":[{"type":"ImportSpecifier","imported":{"type":"Identifier","name":"Body"},"importKind":"value","local":{"type":"Identifier","name":"Body"}}],"source":{"type":"StringLiteral","value":"./utils.js"}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"KB"},"init":{"type":"NumericLiteral","value":1024}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"MB"},"init":{"type":"BinaryExpression","left":{"type":"Identifier","name":"KB"},"operator":"*","right":{"type":"Identifier","name":"KB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"nock"},"computed":false,"property":{"type":"Identifier","name":"disableNetConnect"}},"arguments":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Registers AwsS3Multipart upload plugin"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"pluginNames"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getPlugins"}]}},"arguments":[{"type":"StringLiteral","value":"uploader"}]},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"plugin","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}}],"body":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"plugin"},"computed":false,"property":{"type":"Identifier","name":"constructor"}},"computed":false,"property":{"type":"Identifier","name":"name"}}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"pluginNames"}]},"computed":false,"property":{"type":"Identifier","name":"toContain"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"companionUrl assertion"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Throws an error for main functions if configured without companionUrl"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"err"},"init":{"type":"StringLiteral","value":"Expected a `companionUrl` option"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"file"},"init":{"type":"ObjectExpression","properties":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"opts"},"init":{"type":"ObjectExpression","properties":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"listParts"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"completeMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"abortMultipartUpload"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}},"arguments":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"opts"}]}}]},"computed":false,"property":{"type":"Identifier","name":"toThrow"}},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"non-multipart upload"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"should handle POST uploads"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"limit"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"getUploadParameters"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"POST"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com/"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"fields"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[]}}]}}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"scope"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"POST"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag, Location"}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"options"}},"arguments":[{"type":"StringLiteral","value":"/"}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":204},{"type":"StringLiteral","value":""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/"}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":201},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"Location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"NumericLiteral","value":1}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uploadSuccessHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"upload-success"},{"type":"Identifier","name":"uploadSuccessHandler"}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadSuccessHandler"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}}]},"computed":false,"property":{"type":"Identifier","name":"toHaveLength"}},"arguments":[{"type":"NumericLiteral","value":1}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadSuccessHandler"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":true,"property":{"type":"NumericLiteral","value":0}},"computed":true,"property":{"type":"NumericLiteral","value":1}}]},"computed":false,"property":{"type":"Identifier","name":"toStrictEqual"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"body"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":200}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadURL"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"http://example.com"}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"done"}},"arguments":[]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"without companionUrl (custom main functions)"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"limit"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":0}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"Identifier","name":"file"},{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"number"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"number"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"number"}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"headers"},"computed":false,"shorthand":false,"value":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"number"},"operator":"===","right":{"type":"NumericLiteral","value":1}},"consequent":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"Content-MD5"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"foo"}}]},"alternate":{"type":"Identifier","name":"undefined"}}}]}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSAnyKeyword"}}}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"Keeps chunks marked as busy through retries until they complete"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"scope"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"options"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]},"operator":"&&","right":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"partNumber=7"}]}}}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"calls"},"init":{"type":"NumericLiteral","value":0}}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]},"operator":"&&","right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"partNumber=7"}]}}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"ConditionalExpression","test":{"type":"BinaryExpression","left":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"calls"}},"operator":"===","right":{"type":"NumericLiteral","value":0}},"consequent":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":500}]},"alternate":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]}}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"scope"},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"busySpy"},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"doneSpy"},"init":null}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"retryDelays"},"computed":false,"shorthand":false,"value":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":10}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"multipartUploader"},"init":{"type":"TSNonNullExpression","expression":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"uploaders"}},"computed":true,"property":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"testChunkState"},"init":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"multipartUploader"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getChunkState"}]}},"arguments":[]},"computed":true,"property":{"type":"NumericLiteral","value":6}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"busy"},"init":{"type":"BooleanLiteral","value":false}}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"done"},"init":{"type":"BooleanLiteral","value":false}}],"kind":"let"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"busySpy"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"busy"},"right":{"type":"Identifier","name":"value"}}}],"directives":[]}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"doneSpy"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"done"},"right":{"type":"Identifier","name":"value"}}}],"directives":[]}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"defineProperty"}},"arguments":[{"type":"Identifier","name":"testChunkState"},{"type":"StringLiteral","value":"busy"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"get"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"Identifier","name":"busy"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"set"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"busySpy"}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"defineProperty"}},"arguments":[{"type":"Identifier","name":"testChunkState"},{"type":"StringLiteral","value":"done"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"get"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"Identifier","name":"done"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"set"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"doneSpy"}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":1}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":true,"property":{"type":"NumericLiteral","value":0}},"computed":true,"property":{"type":"NumericLiteral","value":0}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"doneCallOrderNumber"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"doneSpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"invocationCallOrder"}},"computed":true,"property":{"type":"NumericLiteral","value":0}}}],"kind":"const"},{"type":"ForOfStatement","await":false,"left":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ArrayPattern","elements":[{"type":"Identifier","name":"index"},{"type":"Identifier","name":"callArgs"}]},"init":null}],"kind":"const"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"busySpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"entries"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"callArgs"},"computed":true,"property":{"type":"NumericLiteral","value":0}},"operator":"===","right":{"type":"BooleanLiteral","value":false}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSNonNullExpression","expression":{"type":"Identifier","name":"busySpy"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"invocationCallOrder"}},"computed":true,"property":{"type":"Identifier","name":"index"}}]},"computed":false,"property":{"type":"Identifier","name":"toBeGreaterThan"}},"arguments":[{"type":"Identifier","name":"doneCallOrderNumber"}]}}],"directives":[]},"alternate":null}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"TSAsExpression","expression":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"typeAnnotation":{"type":"TSAnyKeyword"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":10}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"MultipartUploader"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"6aeb1980f3fc7ce0b5454d25b71992"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test/upload/multitest.dat"}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPart"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"Identifier","name":"file"},{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"partNumber"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"partNumber"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"partNumber"}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uploadPartBytes"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"afterEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"clearAllMocks"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"retries uploadPartBytes when it fails once"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ThrowStatement","argument":{"type":"StringLiteral","value":"should ignore"}}],"directives":[]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"property":{"type":"Identifier","name":"mockImplementationOnce"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Promise"},"computed":false,"property":{"type":"Identifier","name":"reject"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}},"operator":"+","right":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1},"operator":"*","right":{"type":"Identifier","name":"MB"}}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"uploadPartBytes"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":3}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"calls `upload-error` when uploadPartBytes fails after all retries"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"retryDelays"},"computed":false,"shorthand":false,"value":{"type":"ArrayExpression","elements":[{"type":"NumericLiteral","value":10}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"location"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uploadPartBytes"},"computed":false,"property":{"type":"Identifier","name":"mockImplementation"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Promise"},"computed":false,"property":{"type":"Identifier","name":"reject"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart"},"init":{"type":"TSNonNullExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}},"operator":"+","right":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":1},"operator":"*","right":{"type":"Identifier","name":"MB"}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"mock"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"upload-error"},{"type":"Identifier","name":"mock"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}]},"computed":false,"property":{"type":"Identifier","name":"rejects"}},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"status"},"computed":false,"shorthand":false,"value":{"type":"NumericLiteral","value":500}}]}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"opts"}},"computed":false,"property":{"type":"Identifier","name":"uploadPartBytes"}},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":3}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"mock"},"computed":false,"property":{"type":"Identifier","name":"mock"}},"computed":false,"property":{"type":"Identifier","name":"calls"}},"computed":false,"property":{"type":"Identifier","name":"length"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"NumericLiteral","value":1}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"dynamic companionHeader"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSAnyKeyword"}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oldToken"},"init":{"type":"StringLiteral","value":"old token"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"newToken"},"init":{"type":"StringLiteral","value":"new token"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionUrl"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":""}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"oldToken"}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSAnyKeyword"}}}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"companionHeader is updated before uploading file"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"newToken"}}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"client"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getClient"}]}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"client"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getCompanionHeaders"}]}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"authorization"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"Identifier","name":"newToken"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"dynamic companionHeader using setOption"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"awsS3Multipart","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"newToken"},"init":{"type":"StringLiteral","value":"new token"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"companionHeader is updated before uploading file"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addPreProcessor"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"awsS3Multipart"},"right":{"type":"TSAsExpression","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"getPlugin"}},"arguments":[{"type":"StringLiteral","value":"AwsS3Multipart"}]},"typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"AwsS3Multipart"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":false,"property":{"type":"Identifier","name":"setOptions"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"companionHeaders"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authorization"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"newToken"}}]}}]}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"client"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"awsS3Multipart"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getClient"}]}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"client"},"computed":true,"property":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Symbol"},"computed":false,"property":{"type":"Identifier","name":"for"}},"arguments":[{"type":"StringLiteral","value":"uppy test: getCompanionHeaders"}]}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"authorization"}}]},"computed":false,"property":{"type":"Identifier","name":"toEqual"}},"arguments":[{"type":"Identifier","name":"newToken"}]}}],"directives":[]}}]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"describe"},"arguments":[{"type":"StringLiteral","value":"file metadata across custom main functions"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"core","typeAnnotation":{"type":"TSTypeAnnotation","typeAnnotation":{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]}}}},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uploadId"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"upload1234"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"name"}}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPart"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"listParts"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"partKeys"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}]},"computed":false,"property":{"type":"Identifier","name":"filter"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"metaKey"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"metaKey"},"computed":false,"property":{"type":"Identifier","name":"startsWith"}},"arguments":[{"type":"StringLiteral","value":"part"}]}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"partKeys"},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"metaKey"}],"body":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"PartNumber"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"Identifier","name":"metaKey"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"metaKey"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"Size"},"computed":false,"shorthand":false,"value":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":5},"operator":"*","right":{"type":"Identifier","name":"MB"}}}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"completeMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i"},"init":{"type":"NumericLiteral","value":1}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"i"},"operator":"<=","right":{"type":"NumericLiteral","value":10}},"update":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"i"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"i"}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"Identifier","name":"i"}]}}],"directives":[]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"abortMultipartUpload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"abortingPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"NumericLiteral","value":5}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"beforeEach"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"signPart"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"listParts"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"property":{"type":"Identifier","name":"mockClear"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is completed"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"signPart"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"completeMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPart"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalledTimes"}},"arguments":[{"type":"NumericLiteral","value":11}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"completeMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is aborted"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPartWithAbort"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}},"operator":"===","right":{"type":"NumericLiteral","value":5}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortingPart"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"removeFile"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TSAsExpression","expression":{"type":"TSAsExpression","expression":{"type":"Identifier","name":"undefined"},"typeAnnotation":{"type":"TSAnyKeyword"}},"typeAnnotation":{"type":"TSStringKeyword"}}}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"signPartWithAbort"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"completeMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPartWithAbort"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"abortMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"it"},"arguments":[{"type":"StringLiteral","value":"preserves file metadata if upload is paused and resumed"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"completeMultipartUploadAfterPause"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"signPart"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ForStatement","init":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"i"},"init":{"type":"NumericLiteral","value":1}}],"kind":"let"},"test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"i"},"operator":"<=","right":{"type":"NumericLiteral","value":10}},"update":{"type":"UpdateExpression","operator":"++","prefix":false,"argument":{"type":"Identifier","name":"i"}},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"i"}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"Identifier","name":"i"}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"listParts"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"signPartWithPause"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"vi"},"computed":false,"property":{"type":"Identifier","name":"fn"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"file"},{"type":"Identifier","name":"partData"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}},"computed":false,"property":{"type":"Identifier","name":"createMultipartUpload"}}]},"computed":false,"property":{"type":"Identifier","name":"toBe"}},"arguments":[{"type":"BooleanLiteral","value":true}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}},"operator":"===","right":{"type":"NumericLiteral","value":3}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortingPart"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"pauseResume"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"setTimeout"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"pauseResume"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"NumericLiteral","value":500}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"setFileMeta"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"id"}},{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"file"},"computed":false,"property":{"type":"Identifier","name":"meta"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"part","cooked":"part"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"url"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"partData"},"computed":false,"property":{"type":"Identifier","name":"partNumber"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber=","cooked":"https://bucket.s3.us-east-2.amazonaws.com/test/upload/multitest.dat?partNumber="},"tail":false},{"type":"TemplateElement","value":{"raw":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test","cooked":"&uploadId=6aeb1980f3fc7ce0b5454d25b71992&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATEST%2F20210729%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20210729T014044Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=test"},"tail":true}]}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"core"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"NewExpression","callee":{"type":"Identifier","name":"Core"},"typeParameters":{"type":"TSTypeParameterInstantiation","params":[{"type":"TSAnyKeyword"},{"type":"TSTypeReference","typeName":{"type":"Identifier","name":"Body"}}]},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"AwsS3Multipart"},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"shouldUseMultipart"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"createMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"createMultipartUpload"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"signPart"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"signPartWithPause"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"listParts"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"listParts"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"completeMultipartUpload"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"completeMultipartUploadAfterPause"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"abortMultipartUpload"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"abortMultipartUpload"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"nock"},"arguments":[{"type":"StringLiteral","value":"https://bucket.s3.us-east-2.amazonaws.com"}]},"computed":false,"property":{"type":"Identifier","name":"defaultReplyHeaders"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-method"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"PUT"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-allow-origin"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"*"}},{"type":"ObjectProperty","method":false,"key":{"type":"StringLiteral","value":"access-control-expose-headers"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"ETag"}}]}]},"computed":false,"property":{"type":"Identifier","name":"put"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"uri"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"uri"},"computed":false,"property":{"type":"Identifier","name":"includes"}},"arguments":[{"type":"StringLiteral","value":"test/upload/multitest.dat"}]}}]},"computed":false,"property":{"type":"Identifier","name":"reply"}},"arguments":[{"type":"NumericLiteral","value":200},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ETag"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"test"}}]}]},"computed":false,"property":{"type":"Identifier","name":"persist"}},"arguments":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fileSize"},"init":{"type":"BinaryExpression","left":{"type":"NumericLiteral","value":50},"operator":"*","right":{"type":"Identifier","name":"MB"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"addFile"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"source"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"vi"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"multitest.dat"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"data"},"computed":false,"shorthand":false,"value":{"type":"NewExpression","callee":{"type":"Identifier","name":"File"},"arguments":[{"type":"ArrayExpression","elements":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Uint8Array"},"arguments":[{"type":"Identifier","name":"fileSize"}]}]},{"type":"StringLiteral","value":""},{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"type"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"application/octet-stream"}}]}]}}]}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"core"},"computed":false,"property":{"type":"Identifier","name":"upload"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"createMultipartUpload"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"signPartWithPause"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"listParts"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"expect"},"arguments":[{"type":"Identifier","name":"completeMultipartUploadAfterPause"}]},"computed":false,"property":{"type":"Identifier","name":"toHaveBeenCalled"}},"arguments":[]}}],"directives":[]}}]}}],"directives":[]}}]}}],"directives":[]}}]}}],"directives":[]}}}},"renamedFiles":{"mappings":[],"before":{},"after":{}}}