{"addedFiles":{},"deletedFiles":{},"modifiedFiles":{"before":{"packages/@uppy/companion/src/server/emitter/redis-emitter.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"EventEmitter"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"EventEmitter"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"node:events"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"default"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"safeStringify"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"fast-safe-stringify"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"replacer"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"key"},{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ConditionalExpression","test":{"type":"LogicalExpression","left":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"key"},"computed":true,"property":{"type":"NumericLiteral","value":0}},"operator":"===","right":{"type":"StringLiteral","value":"_"}},"operator":"||","right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"value"},"operator":"===","right":{"type":"StringLiteral","value":"[Circular]"}}},"consequent":{"type":"Identifier","name":"undefined"},"alternate":{"type":"Identifier","name":"value"}}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"redisClient"},{"type":"Identifier","name":"redisPubSubScope"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"prefix"},"init":{"type":"ConditionalExpression","test":{"type":"Identifier","name":"redisPubSubScope"},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"redisPubSubScope"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":":","cooked":":"},"tail":true}]},"alternate":{"type":"StringLiteral","value":""}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getPrefixedEventName"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"}],"body":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"prefix"},{"type":"Identifier","name":"eventName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"publisher"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"redisClient"},"computed":false,"property":{"type":"Identifier","name":"duplicate"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"lazyConnect"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"StringLiteral","value":"publisher redis error"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"subscriber"},"init":null}],"kind":"let"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"connectedPromise"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"connect"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"then"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"subscriber"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"duplicate"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"StringLiteral","value":"subscriber redis error"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"connect"}},"arguments":[]}}],"directives":[]}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handlersByEvent"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Map"},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"errorEmitter"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"EventEmitter"},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handleError"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"emit"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"err"}]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"connectedPromise"},"computed":false,"property":{"type":"Identifier","name":"catch"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"Identifier","name":"err"}]}}]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"runWhenConnected"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"fn"}],"body":{"type":"BlockStatement","body":[{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"Identifier","name":"connectedPromise"}}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"fn"},"arguments":[]}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}},"finalizer":null}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"removeListener"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"removeListener"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handlersByThisEventName"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEvent"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"handlersByThisEventName"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"ReturnStatement","argument":{"type":"Identifier","name":"undefined"}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"actualHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByThisEventName"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"handler"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"actualHandler"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"ReturnStatement","argument":{"type":"Identifier","name":"undefined"}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByThisEventName"},"computed":false,"property":{"type":"Identifier","name":"delete"}},"arguments":[{"type":"Identifier","name":"handler"}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByThisEventName"},"computed":false,"property":{"type":"Identifier","name":"size"}},"operator":"===","right":{"type":"NumericLiteral","value":0}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEvent"},"computed":false,"property":{"type":"Identifier","name":"delete"}},"arguments":[{"type":"Identifier","name":"eventName"}]}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"off"}},"arguments":[{"type":"StringLiteral","value":"pmessage"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"punsubscribe"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}]}}],"directives":[]}}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"addListener"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"},{"type":"AssignmentPattern","left":{"type":"Identifier","name":"_once"},"right":{"type":"BooleanLiteral","value":false}}],"body":{"type":"BlockStatement","body":[{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"actualHandler"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"pattern"},{"type":"Identifier","name":"channel"},{"type":"Identifier","name":"message"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"pattern"},"operator":"!==","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"Identifier","name":"_once"},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"removeListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"args"},"init":null}],"kind":"let"},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"args"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"JSON"},"computed":false,"property":{"type":"Identifier","name":"parse"}},"arguments":[{"type":"Identifier","name":"message"}]}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"ex"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Error"},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"message"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Invalid JSON received! Channel: ","cooked":"Invalid JSON received! Channel: "},"tail":false},{"type":"TemplateElement","value":{"raw":" Message: ","cooked":" Message: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}]}},{"type":"ReturnStatement","argument":null}],"directives":[]}},"finalizer":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handler"},"arguments":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"args"}}]}}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handlersByThisEventName"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEvent"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"kind":"let"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"handlersByThisEventName"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"handlersByThisEventName"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"WeakMap"},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEvent"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handlersByThisEventName"}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByThisEventName"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"handler"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"pmessage"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"psubscribe"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}]}}],"directives":[]}}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"on"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"addListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"off"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"removeListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"once"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"once"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"addListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"},{"type":"BooleanLiteral","value":true}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"emit"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"},{"type":"RestElement","argument":{"type":"Identifier","name":"args"}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"publish"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]},{"type":"CallExpression","callee":{"type":"Identifier","name":"safeStringify"},"arguments":[{"type":"Identifier","name":"args"},{"type":"Identifier","name":"replacer"}]}]}}]}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"removeAllListeners"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"removeAllListeners"}},"arguments":[{"type":"Identifier","name":"eventName"}]}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEvent"},"computed":false,"property":{"type":"Identifier","name":"delete"}},"arguments":[{"type":"Identifier","name":"eventName"}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"punsubscribe"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}]}}],"directives":[]}}]}}],"directives":[]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"on"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"on"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"off"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"off"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"once"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"once"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"emit"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"emit"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"removeListener"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"removeListener"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"removeAllListeners"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"removeAllListeners"}}]}}],"directives":[]}}}}],"directives":[]}}},"after":{"packages/@uppy/companion/src/server/emitter/redis-emitter.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"EventEmitter"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"EventEmitter"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"node:events"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"default"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"safeStringify"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"fast-safe-stringify"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"replacer"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"key"},{"type":"Identifier","name":"value"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ConditionalExpression","test":{"type":"LogicalExpression","left":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"key"},"computed":true,"property":{"type":"NumericLiteral","value":0}},"operator":"===","right":{"type":"StringLiteral","value":"_"}},"operator":"||","right":{"type":"BinaryExpression","left":{"type":"Identifier","name":"value"},"operator":"===","right":{"type":"StringLiteral","value":"[Circular]"}}},"consequent":{"type":"Identifier","name":"undefined"},"alternate":{"type":"Identifier","name":"value"}}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"redisClient"},{"type":"Identifier","name":"redisPubSubScope"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"prefix"},"init":{"type":"ConditionalExpression","test":{"type":"Identifier","name":"redisPubSubScope"},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"redisPubSubScope"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":":","cooked":":"},"tail":true}]},"alternate":{"type":"StringLiteral","value":""}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getPrefixedEventName"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"eventName"}],"body":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"prefix"},{"type":"Identifier","name":"eventName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"errorEmitter"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"EventEmitter"},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handleError"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"emit"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"err"}]}}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"makeRedis"},"generator":false,"async":true,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"publisher"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"redisClient"},"computed":false,"property":{"type":"Identifier","name":"duplicate"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"lazyConnect"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"StringLiteral","value":"publisher redis error"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"subscriber"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"duplicate"}},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"StringLiteral","value":"subscriber redis error"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"connect"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"connect"}},"arguments":[]}}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"subscriber"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"subscriber"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"publisher"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"publisher"}}]}}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redisPromise"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"makeRedis"},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"redisPromise"},"computed":false,"property":{"type":"Identifier","name":"catch"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"err"}],"body":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"Identifier","name":"err"}]}}]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"runWhenConnected"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"fn"}],"body":{"type":"BlockStatement","body":[{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"fn"},"arguments":[{"type":"AwaitExpression","argument":{"type":"Identifier","name":"redisPromise"}}]}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}},"finalizer":null}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handlersByEventName"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Map"},"arguments":[]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"removeListener"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"removeListener"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"actualHandlerByHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEventName"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"actualHandlerByHandler"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"actualHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"actualHandlerByHandler"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"handler"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"actualHandler"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"actualHandlerByHandler"},"computed":false,"property":{"type":"Identifier","name":"delete"}},"arguments":[{"type":"Identifier","name":"handler"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"didRemoveLastListener"},"init":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"actualHandlerByHandler"},"computed":false,"property":{"type":"Identifier","name":"size"}},"operator":"===","right":{"type":"NumericLiteral","value":0}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"Identifier","name":"didRemoveLastListener"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEventName"},"computed":false,"property":{"type":"Identifier","name":"delete"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"subscriber"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"subscriber"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"off"}},"arguments":[{"type":"StringLiteral","value":"pmessage"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"IfStatement","test":{"type":"Identifier","name":"didRemoveLastListener"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"punsubscribe"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}]}}}],"directives":[]},"alternate":null}],"directives":[]}}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"addListener"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"},{"type":"AssignmentPattern","left":{"type":"Identifier","name":"_once"},"right":{"type":"BooleanLiteral","value":false}}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"Identifier","name":"_once"},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"once"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}},"alternate":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"addListener"}},"arguments":[{"type":"StringLiteral","value":"error"},{"type":"Identifier","name":"handler"}]}}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"actualHandler"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"pattern"},{"type":"Identifier","name":"channel"},{"type":"Identifier","name":"message"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"pattern"},"operator":"!==","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"Identifier","name":"_once"},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"removeListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"args"},"init":null}],"kind":"let"},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"args"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"JSON"},"computed":false,"property":{"type":"Identifier","name":"parse"}},"arguments":[{"type":"Identifier","name":"message"}]}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"ex"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handleError"},"arguments":[{"type":"NewExpression","callee":{"type":"Identifier","name":"Error"},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"message"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Invalid JSON received! Channel: ","cooked":"Invalid JSON received! Channel: "},"tail":false},{"type":"TemplateElement","value":{"raw":" Message: ","cooked":" Message: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}]}},{"type":"ReturnStatement","argument":null}],"directives":[]}},"finalizer":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"handler"},"arguments":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"args"}}]}}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"actualHandlerByHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEventName"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"kind":"let"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"actualHandlerByHandler"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"actualHandlerByHandler"},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"Map"},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEventName"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"actualHandlerByHandler"}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"actualHandlerByHandler"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"handler"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"subscriber"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"subscriber"}}]}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"on"}},"arguments":[{"type":"StringLiteral","value":"pmessage"},{"type":"Identifier","name":"actualHandler"}]}},{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"subscriber"},"computed":false,"property":{"type":"Identifier","name":"psubscribe"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]}]}}}],"directives":[]}}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"on"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"addListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"off"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"removeListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"once"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"addListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"},{"type":"BooleanLiteral","value":true}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"emit"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"},{"type":"RestElement","argument":{"type":"Identifier","name":"args"}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"runWhenConnected"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":true,"params":[{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"publisher"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"publisher"}}]}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"publisher"},"computed":false,"property":{"type":"Identifier","name":"publish"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getPrefixedEventName"},"arguments":[{"type":"Identifier","name":"eventName"}]},{"type":"CallExpression","callee":{"type":"Identifier","name":"safeStringify"},"arguments":[{"type":"Identifier","name":"args"},{"type":"Identifier","name":"replacer"}]}]}}]}}}],"directives":[]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"removeAllListeners"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"eventName"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"eventName"},"operator":"===","right":{"type":"StringLiteral","value":"error"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"errorEmitter"},"computed":false,"property":{"type":"Identifier","name":"removeAllListeners"}},"arguments":[{"type":"Identifier","name":"eventName"}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"actualHandlerByHandler"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"handlersByEventName"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"Identifier","name":"eventName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"actualHandlerByHandler"},"operator":"!=","right":{"type":"NullLiteral"}},"consequent":{"type":"BlockStatement","body":[{"type":"ForOfStatement","await":false,"left":{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"handler"},"init":null}],"kind":"const"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"actualHandlerByHandler"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"removeListener"},"arguments":[{"type":"Identifier","name":"eventName"},{"type":"Identifier","name":"handler"}]}}}],"directives":[]}}],"directives":[]},"alternate":null}],"directives":[]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"on"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"on"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"off"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"off"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"once"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"once"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"emit"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"emit"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"removeListener"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"removeListener"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"removeAllListeners"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"removeAllListeners"}}]}}],"directives":[]}}}}],"directives":[]}}}},"renamedFiles":{"mappings":[],"before":{},"after":{}}}