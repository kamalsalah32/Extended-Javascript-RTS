{"addedFiles":{},"deletedFiles":{},"modifiedFiles":{"before":{"packages/@uppy/companion/src/companion.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"express"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"Grant"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"grant"}]},"computed":false,"property":{"type":"Identifier","name":"default"}},"computed":false,"property":{"type":"Identifier","name":"express"}},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"merge"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"lodash/merge"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"cookieParser"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"cookie-parser"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"interceptor"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express-interceptor"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"randomUUID"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"randomUUID"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"node:crypto"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"grantConfig"},"init":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./config/grant"}]},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerManager"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"controllers"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"s3"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers/s3"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"url"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers/url"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createEmitter"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/emitter"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redis"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/redis"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"jobs"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/jobs"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middlewares"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/middlewares"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getMaskableSecrets"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getMaskableSecrets"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"defaultOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"defaultOptions"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"validateConfig"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"validateConfig"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./config/companion"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderApiError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderApiError"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderUserError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderUserError"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderAuthError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderAuthError"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/error"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/credentials"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"version"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../package.json"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/Provider"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"setLoggerProcessName"},"generator":false,"async":false,"params":[{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"loggerProcessName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"loggerProcessName"}}]}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"loggerProcessName"},"operator":"!=","right":{"type":"NullLiteral"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"setProcessName"}},"arguments":[{"type":"Identifier","name":"loggerProcessName"}]}},"alternate":null}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"interceptGrantErrorResponse"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"interceptor"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"isInterceptable"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"RegExpLiteral","pattern":"^\\/connect\\/\\w+\\/callback","flags":""},"computed":false,"property":{"type":"Identifier","name":"test"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"path"}}]}}],"directives":[]}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"intercept"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"body"},{"type":"Identifier","name":"send"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"unwantedBody"},"init":{"type":"StringLiteral","value":"error=Grant%3A%20missing%20session%20or%20misconfigured%20provider"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"body"},"operator":"===","right":{"type":"Identifier","name":"unwantedBody"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"body"}],"quasis":[{"type":"TemplateElement","value":{"raw":"grant.js responded with error: ","cooked":"grant.js responded with error: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"StringLiteral","value":"grant.oauth.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"StringLiteral","value":"Content-Type"},{"type":"StringLiteral","value":"text/plain"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"reqHint"},"init":{"type":"ConditionalExpression","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"Request ID: ","cooked":"Request ID: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"alternate":{"type":"StringLiteral","value":""}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"send"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"Companion was unable to complete the OAuth process :("},{"type":"StringLiteral","value":"Error: User session is missing or the Provider was misconfigured"},{"type":"Identifier","name":"reqHint"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":"\n"}]}]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"send"},"arguments":[{"type":"Identifier","name":"body"}]}}],"directives":[]}}],"directives":[]}}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"errors"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderApiError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderApiError"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderUserError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderUserError"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderAuthError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderAuthError"}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"socket"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/socket"}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"setLoggerProcessName"}},"right":{"type":"Identifier","name":"setLoggerProcessName"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"app"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"Identifier","name":"optionsArg"},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"setLoggerProcessName"},"arguments":[{"type":"Identifier","name":"optionsArg"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"validateConfig"},"arguments":[{"type":"Identifier","name":"optionsArg"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"options"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"merge"},"arguments":[{"type":"ObjectExpression","properties":[]},{"type":"Identifier","name":"defaultOptions"},{"type":"Identifier","name":"optionsArg"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providers"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"customProviders"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"customProviders"}}]},"init":{"type":"Identifier","name":"options"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"Identifier","name":"customProviders"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"addCustomProviders"}},"arguments":[{"type":"Identifier","name":"customProviders"},{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getOauthProvider"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"},"optional":true}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"addProviderOptions"}},"arguments":[{"type":"Identifier","name":"options"},{"type":"Identifier","name":"grantConfig"},{"type":"Identifier","name":"getOauthProvider"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"setMaskables"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getMaskableSecrets"},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redisClient"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"redis"},"computed":false,"property":{"type":"Identifier","name":"client"}},"arguments":[{"type":"Identifier","name":"options"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"emitter"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"createEmitter"},"arguments":[{"type":"Identifier","name":"redisClient"},{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"redisPubSubScope"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"app"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"express"},"arguments":[]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"path"}}}]}]}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"cookieParser"},"arguments":[]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"interceptGrantErrorResponse"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/connect/:oauthProvider/:override?"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"urlencoded"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"extended"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}}]}]},{"type":"CallExpression","callee":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"},"arguments":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"Grant"},"arguments":[{"type":"Identifier","name":"grantConfig"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"protocol"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"protocol"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"header"}},"arguments":[{"type":"StringLiteral","value":"i-am"},{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"protocol"},{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"://","cooked":"://"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"cors"}},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"*"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"getCompanionMiddleware"}},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/s3"},{"type":"CallExpression","callee":{"type":"Identifier","name":"s3"},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"s3"}}]}]}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"enableUrlEndpoint"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/url"},{"type":"CallExpression","callee":{"type":"Identifier","name":"url"},"arguments":[]}]}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/preauth"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"urlencoded"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"extended"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}}]}]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"preauth"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/connect"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"connect"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/redirect"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"redirect"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/callback"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"callback"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/refresh-token"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/deauthorization/callback"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"deauthorizationCallback"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/logout"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"gentleVerifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"logout"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/send-token"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"sendToken"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/simple-auth"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"simpleAuth"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/list/:id?"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"list"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/search/:providerName/list"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"list"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/get/:id"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"get"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/search/:providerName/get/:id"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"get"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/thumbnail/:id"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"cookieAuthToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"thumbnail"}}]}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"testDynamicOauthCredentials"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/test-dynamic-oauth-credentials"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},"operator":"!==","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"testDynamicOauthCredentialsSecret"}}},"consequent":{"type":"ThrowStatement","argument":{"type":"NewExpression","callee":{"type":"Identifier","name":"Error"},"arguments":[{"type":"StringLiteral","value":"Invalid secret"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Returning dynamic OAuth2 credentials for ","cooked":"Returning dynamic OAuth2 credentials for "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"key"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"key"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"secret"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"getRedirectUri"},"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oauthProvider"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"getOauthProvider"},"arguments":[{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]}},"consequent":{"type":"ReturnStatement","argument":{"type":"Identifier","name":"undefined"}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"},"optional":true}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"send"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"credentials"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"key"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"secret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"redirect_uri"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getRedirectUri"},"arguments":[]}}]}}]}]}}],"directives":[]}}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"param"}},"arguments":[{"type":"StringLiteral","value":"providerName"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"getProviderMiddleware"}},"arguments":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}]}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"env"}]},"operator":"!==","right":{"type":"StringLiteral","value":"test"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"jobs"},"computed":false,"property":{"type":"Identifier","name":"startCleanUpJob"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"filePath"}}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"processId"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"randomUUID"},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"jobs"},"computed":false,"property":{"type":"Identifier","name":"startPeriodicPingJob"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"urls"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingUrls"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"interval"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingInterval"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"count"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingCount"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"staticPayload"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingStaticPayload"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"version"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"processId"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"processId"}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"app"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"app"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"emitter"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"emitter"}}]}}],"directives":[]}}}}],"directives":[]}},"packages/@uppy/companion/src/server/controllers/preauth.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"preauth"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}}},"operator":"||","right":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}},"computed":false,"property":{"type":"Identifier","name":"params"}}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"StringLiteral","value":"invalid request data received"},{"type":"StringLiteral","value":"preauth.bad"}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerConfig"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}},"computed":false,"property":{"type":"Identifier","name":"providerName"}}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerConfig"},"computed":false,"property":{"type":"Identifier","name":"credentialsURL"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":501}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"preAuthToken"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"generateEncryptedToken"}},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}},"computed":false,"property":{"type":"Identifier","name":"params"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"preAuthSecret"}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"token"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"preAuthToken"}}]}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"Identifier","name":"preauth"}}}],"directives":[]}},"packages/@uppy/companion/src/server/controllers/refresh-token.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"respondWithError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"respondWithError"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../provider/error"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"refreshToken"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"key"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"clientId"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"secret"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"clientSecret"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"redirect_uri"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"redirectUri"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerGrantConfig"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerUserSession"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerUserSession"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"operator":"==","right":{"type":"NullLiteral"}},"operator":"||","right":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"operator":"===","right":{"type":"StringLiteral","value":""}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"Tried to refresh token without having a token"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"data"},"init":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"redirectUri"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"redirectUri"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"clientId"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"clientId"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"clientSecret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"clientSecret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"refreshToken"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}}}]}]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"providerUserSession"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"accessToken"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"data"},"computed":false,"property":{"type":"Identifier","name":"accessToken"}}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Generating refreshed auth token for provider ","cooked":"Generating refreshed auth token for provider "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uppyAuthToken"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"generateEncryptedAuthToken"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"Identifier","name":"providerName"},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}}}]},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"authStateExpiry"}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"addToCookiesIfNeeded"}},"arguments":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"uppyAuthToken"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"authStateExpiry"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"send"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uppyAuthToken"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"uppyAuthToken"}}]}]}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"respondWithError"},"arguments":[{"type":"Identifier","name":"err"},{"type":"Identifier","name":"res"}]},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}},"finalizer":null}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"Identifier","name":"refreshToken"}}}],"directives":[]}},"packages/@uppy/companion/src/server/middlewares.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"cors"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"cors"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"promBundle"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express-prom-bundle"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"version"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../../package.json"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getS3Client"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./s3-client"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getURLBuilder"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getURLBuilder"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./helpers/utils"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./provider/Provider"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"session"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No session attached to req object. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No provider/provider-handler found. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isOAuthProviderReq"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"}],"body":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"}}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"}],"body":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuth"}}}}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"Provider does not support OAuth."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuthProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"Provider does not support simple auth."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No body attached to req object. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSearchQuery"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"q"}}},"operator":"!==","right":{"type":"StringLiteral","value":"string"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"search request has no search query"},{"type":"StringLiteral","value":"search.query.check"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]},"operator":"||","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"token"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"token"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"StringLiteral","value":"cannot auth token"},{"type":"StringLiteral","value":"token.verify.unset"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"payload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"verifyEncryptedAuthToken"}},"arguments":[{"type":"Identifier","name":"token"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"payload"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"message"}},{"type":"StringLiteral","value":"token.verify.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]}},"finalizer":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}},"operator":"||","right":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"unconfigured credentials for ","cooked":"unconfigured credentials for "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"StringLiteral","value":"non.oauth.token.load.unset"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":501}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"accessToken"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]},"alternate":null}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"gentleVerifyToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},"consequent":{"type":"BlockStatement","body":[{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"payload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"verifyEncryptedAuthToken"}},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"payload"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"message"}},{"type":"StringLiteral","value":"token.gentle.verify.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}}],"directives":[]}},"finalizer":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"cookieAuthToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"cookies"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"uppyAuthToken--","cooked":"uppyAuthToken--"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"cors"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"Identifier","name":"options"},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingExposeHeaders"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Expose-Headers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"exposeHeadersSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"existingExposeHeaders"},"computed":false,"property":{"type":"Identifier","name":"split"},"optional":true},"optional":false,"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"},"optional":true},"optional":false,"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toLowerCase"}},"arguments":[]}}]}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"exposeHeadersSet"},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"i-am"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowedHeaders"},"init":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"uppy-auth-token"},{"type":"StringLiteral","value":"uppy-credentials-params"},{"type":"StringLiteral","value":"authorization"},{"type":"StringLiteral","value":"origin"},{"type":"StringLiteral","value":"content-type"},{"type":"StringLiteral","value":"accept"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingAllowHeaders"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Allow-Headers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowHeadersSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"ConditionalExpression","test":{"type":"Identifier","name":"existingAllowHeaders"},"consequent":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"existingAllowHeaders"},"computed":false,"property":{"type":"Identifier","name":"split"}},"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toLowerCase"}},"arguments":[]}}]},"computed":false,"property":{"type":"Identifier","name":"concat"}},"arguments":[{"type":"Identifier","name":"allowedHeaders"}]},"alternate":{"type":"Identifier","name":"allowedHeaders"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingAllowMethods"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Allow-Methods"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowMethodsSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"existingAllowMethods"},"computed":false,"property":{"type":"Identifier","name":"split"},"optional":true},"optional":false,"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"},"optional":true},"optional":false,"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toUpperCase"}},"arguments":[]}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"allowMethodsSet"},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"GET"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"POST"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"OPTIONS"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"DELETE"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"corsOrigins"},"computed":false,"method":false,"shorthand":false,"value":{"type":"AssignmentPattern","left":{"type":"Identifier","name":"origin"},"right":{"type":"BooleanLiteral","value":true}}}]},"init":{"type":"Identifier","name":"options"}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"cors"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"credentials"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"origin"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"origin"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"methods"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"allowMethodsSet"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"allowedHeaders"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"allowHeadersSet"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":","}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"exposedHeaders"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"exposeHeadersSet"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":","}]}}]}]},"arguments":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}]}}],"directives":[]}}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":true,"value":{"type":"AssignmentPattern","left":{"type":"Identifier","name":"path"},"right":{"type":"Identifier","name":"undefined"}}}]},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"metricsMiddleware"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"promBundle"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"includeMethod"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"metricsPath"},"computed":false,"shorthand":false,"value":{"type":"ConditionalExpression","test":{"type":"Identifier","name":"path"},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"path"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"/metrics","cooked":"/metrics"},"tail":true}]},"alternate":{"type":"Identifier","name":"undefined"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"promClient"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"promClient"}}]},"init":{"type":"Identifier","name":"metricsMiddleware"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"collectDefaultMetrics"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"collectDefaultMetrics"}}]},"init":{"type":"Identifier","name":"promClient"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"collectDefaultMetrics"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"register"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"promClient"},"computed":false,"property":{"type":"Identifier","name":"register"}}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"versionGauge"},"init":{"type":"NewExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"promClient"},"computed":false,"property":{"type":"Identifier","name":"Gauge"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"companion_version"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"help"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"npm version as an integer"}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"numberVersion"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"Number"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"version"},"computed":false,"property":{"type":"Identifier","name":"replace"}},"arguments":[{"type":"RegExpLiteral","pattern":"\\D","flags":"g"},{"type":"StringLiteral","value":""}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"versionGauge"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"numberVersion"}]}},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"metricsMiddleware"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"getCompanionMiddleware"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"options"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middleware"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"options"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"options"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"s3Client"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getS3Client"},"arguments":[{"type":"Identifier","name":"options"},{"type":"BooleanLiteral","value":false}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"s3ClientCreatePresignedPost"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getS3Client"},"arguments":[{"type":"Identifier","name":"options"},{"type":"BooleanLiteral","value":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authToken"},"computed":false,"shorthand":false,"value":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"header"}},"arguments":[{"type":"StringLiteral","value":"uppy-auth-token"}]},"operator":"||","right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"uppyAuthToken"}}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"buildURL"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"options"}]}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"middleware"}}],"directives":[]}}}}],"directives":[]}},"packages/@uppy/companion/src/server/provider/index.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"dropbox"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./dropbox"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"box"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./box"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"drive"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./google/drive"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"googlephotos"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./google/googlephotos"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"instagram"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./instagram/graph"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"facebook"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./facebook"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"onedrive"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./onedrive"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"unsplash"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./unsplash"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"zoom"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./zoom"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getURLBuilder"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getURLBuilder"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/utils"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getCredentialsResolver"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getCredentialsResolver"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./credentials"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"Provider"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./Provider"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"Identifier","name":"Provider"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"validOptions"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"options"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"host"}},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"protocol"}}}}],"directives":[]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"getProviderMiddleware"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middleware"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"},{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"ProviderClass"},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"Identifier","name":"ProviderClass"},"operator":"&&","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"validOptions"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"allowLocalUrls"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"allowLocalUrls"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthProvider"}}]},"init":{"type":"Identifier","name":"ProviderClass"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerGrantConfig"},"init":null}],"kind":"let"},{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"getProviderCredentials"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"getCredentialsResolver"},"arguments":[{"type":"Identifier","name":"providerName"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},{"type":"Identifier","name":"req"}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"providerGrantConfig"},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerGrantConfig"}},"right":{"type":"Identifier","name":"providerGrantConfig"}}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"secret"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"ProviderClass"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"secret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"providerName"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"providerGrantConfig"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"providerGrantConfig"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"allowLocalUrls"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"allowLocalUrls"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"right":{"type":"Identifier","name":"ProviderClass"}}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"invalid provider options detected. Provider will not be loaded"},{"type":"StringLiteral","value":"provider.middleware.invalid"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"middleware"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providers"},"init":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"dropbox"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"dropbox"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"box"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"box"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"drive"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"drive"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"googlephotos"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"googlephotos"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"facebook"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"facebook"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onedrive"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"onedrive"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"zoom"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"zoom"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"instagram"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"instagram"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"unsplash"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"unsplash"}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"providers"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"addCustomProviders"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"customProviders"},{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"Identifier","name":"customProviders"}]},"computed":false,"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"customProvider"},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProviders"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"module"}}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthProvider"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"module"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"config"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"callback"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","value":{"raw":"/callback","cooked":"/callback"},"tail":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"transport"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"session"}}]}}}],"directives":[]},"alternate":null}],"directives":[]}}]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"addProviderOptions"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"companionOptions"},{"type":"Identifier","name":"grantConfig"},{"type":"Identifier","name":"getOauthProvider"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"server"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"server"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"Identifier","name":"companionOptions"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"validOptions"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"server"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"server"}}]}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"invalid provider options detected. Providers will not be loaded"},{"type":"StringLiteral","value":"provider.options.invalid"}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":false,"property":{"type":"Identifier","name":"defaults"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"host"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"host"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"protocol"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"protocol"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}}}]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthDomain"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthDomain"}}]},"init":{"type":"Identifier","name":"server"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"keys"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"Identifier","name":"providerOptions"}]},"computed":false,"property":{"type":"Identifier","name":"filter"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"key"}],"body":{"type":"BinaryExpression","left":{"type":"Identifier","name":"key"},"operator":"!==","right":{"type":"StringLiteral","value":"server"}}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"keys"},"computed":false,"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oauthProvider"},"init":{"type":"OptionalCallExpression","callee":{"type":"Identifier","name":"getOauthProvider"},"optional":true,"arguments":[{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"key"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"secret"}}}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"credentialsURL"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"dynamic"}},"right":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"key"},{"type":"StringLiteral","value":"secret"},{"type":"StringLiteral","value":"redirect_uri"}]}}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"provider"},"init":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"arguments":[]},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"assign"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"provider"},"computed":false,"property":{"type":"Identifier","name":"getExtraGrantConfig"}},"arguments":[]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isExternal"},"init":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redirectPath"},"init":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","value":{"raw":"/redirect","cooked":"/redirect"},"tail":true}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"}},"right":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"companionOptions"}]},"arguments":[{"type":"Identifier","name":"redirectPath"},{"type":"Identifier","name":"isExternal"}]}}},{"type":"IfStatement","test":{"type":"Identifier","name":"oauthDomain"},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fullRedirectPath"},"init":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"companionOptions"}]},"arguments":[{"type":"Identifier","name":"redirectPath"},{"type":"Identifier","name":"isExternal"},{"type":"BooleanLiteral","value":true}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"protocol"}},{"type":"Identifier","name":"oauthDomain"},{"type":"Identifier","name":"fullRedirectPath"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"://","cooked":"://"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":null}}],"directives":[]},"alternate":null}],"directives":[]}}]}}],"directives":[]}}}}],"directives":[]}}},"after":{"packages/@uppy/companion/src/companion.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"express"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"Grant"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"grant"}]},"computed":false,"property":{"type":"Identifier","name":"default"}},"computed":false,"property":{"type":"Identifier","name":"express"}},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"merge"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"lodash/merge"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"cookieParser"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"cookie-parser"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"interceptor"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express-interceptor"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"randomUUID"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"randomUUID"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"node:crypto"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"grantConfig"},"init":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./config/grant"}]},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerManager"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"controllers"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"s3"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers/s3"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"url"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/controllers/url"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"createEmitter"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/emitter"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redis"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/redis"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"jobs"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/jobs"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middlewares"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/middlewares"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getMaskableSecrets"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getMaskableSecrets"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"defaultOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"defaultOptions"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"validateConfig"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"validateConfig"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./config/companion"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderApiError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderApiError"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderUserError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderUserError"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"ProviderAuthError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderAuthError"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/error"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/credentials"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"version"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../package.json"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/provider/Provider"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"setLoggerProcessName"},"generator":false,"async":false,"params":[{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"loggerProcessName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"loggerProcessName"}}]}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"loggerProcessName"},"operator":"!=","right":{"type":"NullLiteral"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"setProcessName"}},"arguments":[{"type":"Identifier","name":"loggerProcessName"}]}},"alternate":null}],"directives":[]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"interceptGrantErrorResponse"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"interceptor"},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"isInterceptable"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"RegExpLiteral","pattern":"^\\/connect\\/\\w+\\/callback","flags":""},"computed":false,"property":{"type":"Identifier","name":"test"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"path"}}]}}],"directives":[]}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"intercept"},"computed":false,"shorthand":false,"value":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"body"},{"type":"Identifier","name":"send"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"unwantedBody"},"init":{"type":"StringLiteral","value":"error=Grant%3A%20missing%20session%20or%20misconfigured%20provider"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"body"},"operator":"===","right":{"type":"Identifier","name":"unwantedBody"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"body"}],"quasis":[{"type":"TemplateElement","value":{"raw":"grant.js responded with error: ","cooked":"grant.js responded with error: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"StringLiteral","value":"grant.oauth.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"StringLiteral","value":"Content-Type"},{"type":"StringLiteral","value":"text/plain"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"reqHint"},"init":{"type":"ConditionalExpression","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"Request ID: ","cooked":"Request ID: "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},"alternate":{"type":"StringLiteral","value":""}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"send"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"Companion was unable to complete the OAuth process :("},{"type":"StringLiteral","value":"Error: User session is missing or the Provider was misconfigured"},{"type":"Identifier","name":"reqHint"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":"\n"}]}]}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"send"},"arguments":[{"type":"Identifier","name":"body"}]}}],"directives":[]}}],"directives":[]}}}]}}],"directives":[]}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"errors"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderApiError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderApiError"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderUserError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderUserError"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"ProviderAuthError"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"ProviderAuthError"}}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"socket"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./server/socket"}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"setLoggerProcessName"}},"right":{"type":"Identifier","name":"setLoggerProcessName"}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"app"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"Identifier","name":"optionsArg"},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"setLoggerProcessName"},"arguments":[{"type":"Identifier","name":"optionsArg"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"validateConfig"},"arguments":[{"type":"Identifier","name":"optionsArg"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"options"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"merge"},"arguments":[{"type":"ObjectExpression","properties":[]},{"type":"Identifier","name":"defaultOptions"},{"type":"Identifier","name":"optionsArg"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providers"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"arguments":[]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"customProviders"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"customProviders"}}]},"init":{"type":"Identifier","name":"options"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"Identifier","name":"customProviders"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"addCustomProviders"}},"arguments":[{"type":"Identifier","name":"customProviders"},{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getOauthProvider"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"},"optional":true}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"addProviderOptions"}},"arguments":[{"type":"Identifier","name":"options"},{"type":"Identifier","name":"grantConfig"},{"type":"Identifier","name":"getOauthProvider"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"setMaskables"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"getMaskableSecrets"},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redisClient"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"redis"},"computed":false,"property":{"type":"Identifier","name":"client"}},"arguments":[{"type":"Identifier","name":"options"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"emitter"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"createEmitter"},"arguments":[{"type":"Identifier","name":"redisClient"},{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"redisPubSubScope"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"app"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"express"},"arguments":[]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"path"}}}]}]}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"cookieParser"},"arguments":[]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"Identifier","name":"interceptGrantErrorResponse"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/connect/:oauthProvider/:override?"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"urlencoded"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"extended"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}}]}]},{"type":"CallExpression","callee":{"type":"Identifier","name":"getCredentialsOverrideMiddleware"},"arguments":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"Identifier","name":"Grant"},"arguments":[{"type":"Identifier","name":"grantConfig"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"protocol"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"protocol"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"header"}},"arguments":[{"type":"StringLiteral","value":"i-am"},{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"protocol"},{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"://","cooked":"://"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"cors"}},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"*"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"getCompanionMiddleware"}},"arguments":[{"type":"Identifier","name":"options"}]}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/s3"},{"type":"CallExpression","callee":{"type":"Identifier","name":"s3"},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"s3"}}]}]}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"enableUrlEndpoint"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"use"}},"arguments":[{"type":"StringLiteral","value":"/url"},{"type":"CallExpression","callee":{"type":"Identifier","name":"url"},"arguments":[]}]}},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/preauth"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"urlencoded"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"extended"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":false}}]}]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"preauth"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/connect"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"connect"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/redirect"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"redirect"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/callback"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"callback"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/refresh-token"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/deauthorization/callback"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"deauthorizationCallback"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/logout"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"gentleVerifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"logout"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/send-token"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"sendToken"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/simple-auth"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"simpleAuth"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/list/:id?"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"list"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/search/:providerName/list"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"list"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/get/:id"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"get"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/search/:providerName/get/:id"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"express"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[]},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"get"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/thumbnail/:id"},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"cookieAuthToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"middlewares"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},{"type":"MemberExpression","object":{"type":"Identifier","name":"controllers"},"computed":false,"property":{"type":"Identifier","name":"thumbnail"}}]}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"testDynamicOauthCredentials"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"post"}},"arguments":[{"type":"StringLiteral","value":"/:providerName/test-dynamic-oauth-credentials"},{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},"operator":"!==","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"testDynamicOauthCredentialsSecret"}}},"consequent":{"type":"ThrowStatement","argument":{"type":"NewExpression","callee":{"type":"Identifier","name":"Error"},"arguments":[{"type":"StringLiteral","value":"Invalid secret"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Returning dynamic OAuth2 credentials for ","cooked":"Returning dynamic OAuth2 credentials for "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"key"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"key"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"secret"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}}]},"init":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"operator":"??","right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"__proto__"},"computed":false,"shorthand":false,"value":{"type":"NullLiteral"}}]}}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"getRedirectUri"},"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oauthProvider"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"getOauthProvider"},"arguments":[{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]}},"consequent":{"type":"ReturnStatement","argument":{"type":"Identifier","name":"undefined"}},"alternate":null},{"type":"ReturnStatement","argument":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"},"optional":true}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"send"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"credentials"},"computed":false,"shorthand":false,"value":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"key"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"key"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"secret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"redirect_uri"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getRedirectUri"},"arguments":[]}}]}}]}]}}],"directives":[]}}]}}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"param"}},"arguments":[{"type":"StringLiteral","value":"providerName"},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerManager"},"computed":false,"property":{"type":"Identifier","name":"getProviderMiddleware"}},"arguments":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}]}]}},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"app"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"env"}]},"operator":"!==","right":{"type":"StringLiteral","value":"test"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"jobs"},"computed":false,"property":{"type":"Identifier","name":"startCleanUpJob"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"filePath"}}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"processId"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"randomUUID"},"arguments":[]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"jobs"},"computed":false,"property":{"type":"Identifier","name":"startPeriodicPingJob"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"urls"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingUrls"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"interval"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingInterval"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"count"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingCount"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"staticPayload"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"periodicPingStaticPayload"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"version"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"processId"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"processId"}}]}]}},{"type":"ReturnStatement","argument":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"app"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"app"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"emitter"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"emitter"}}]}}],"directives":[]}}}}],"directives":[]}},"packages/@uppy/companion/src/server/controllers/preauth.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"preauth"},"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}}},"operator":"||","right":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}},"computed":false,"property":{"type":"Identifier","name":"params"}}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"StringLiteral","value":"invalid request data received"},{"type":"StringLiteral","value":"preauth.bad"}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerConfig"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}},"computed":false,"property":{"type":"Identifier","name":"providerName"}}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"providerConfig"},"computed":false,"property":{"type":"Identifier","name":"credentialsURL"},"optional":true}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":501}]}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"preAuthToken"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"generateEncryptedToken"}},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}},"computed":false,"property":{"type":"Identifier","name":"params"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"preAuthSecret"}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"json"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"token"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"preAuthToken"}}]}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"Identifier","name":"preauth"}}}],"directives":[]}},"packages/@uppy/companion/src/server/controllers/refresh-token.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"respondWithError"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"respondWithError"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../provider/error"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"refreshToken"},"generator":false,"async":true,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"key"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"clientId"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"secret"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"clientSecret"}}]},"init":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"providerOptions"}},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"operator":"??","right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"__proto__"},"computed":false,"shorthand":false,"value":{"type":"NullLiteral"}}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"redirect_uri"},"computed":false,"method":false,"shorthand":false,"value":{"type":"Identifier","name":"redirectUri"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerGrantConfig"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerUserSession"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerUserSession"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"operator":"==","right":{"type":"NullLiteral"}},"operator":"||","right":{"type":"BinaryExpression","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"operator":"===","right":{"type":"StringLiteral","value":""}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"Tried to refresh token without having a token"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"data"},"init":{"type":"AwaitExpression","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"redirectUri"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"redirectUri"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"clientId"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"clientId"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"clientSecret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"clientSecret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"refreshToken"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerUserSession"},"computed":false,"property":{"type":"Identifier","name":"refreshToken"}}}]}]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"Identifier","name":"providerUserSession"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"accessToken"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"data"},"computed":false,"property":{"type":"Identifier","name":"accessToken"}}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"Generating refreshed auth token for provider ","cooked":"Generating refreshed auth token for provider "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"uppyAuthToken"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"generateEncryptedAuthToken"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"computed":true,"key":{"type":"Identifier","name":"providerName"},"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}}}]},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"authStateExpiry"}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"addToCookiesIfNeeded"}},"arguments":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"uppyAuthToken"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"authStateExpiry"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"send"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"uppyAuthToken"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"uppyAuthToken"}}]}]}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"respondWithError"},"arguments":[{"type":"Identifier","name":"err"},{"type":"Identifier","name":"res"}]},"consequent":{"type":"ReturnStatement","argument":null},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[{"type":"Identifier","name":"err"}]}}],"directives":[]}},"finalizer":null}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"right":{"type":"Identifier","name":"refreshToken"}}}],"directives":[]}},"packages/@uppy/companion/src/server/middlewares.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"cors"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"cors"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"promBundle"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"express-prom-bundle"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"version"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"version"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../../package.json"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tokenService"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./helpers/jwt"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"getS3Client"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./s3-client"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getURLBuilder"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getURLBuilder"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./helpers/utils"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./provider/Provider"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSessionAndProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"session"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No session attached to req object. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No provider/provider-handler found. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isOAuthProviderReq"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"}],"body":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"}}]}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"}],"body":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuth"}}}}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasOAuthProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"Provider does not support OAuth."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSimpleAuthProvider"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"Provider does not support simple auth."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasBody"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"body"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"No body attached to req object. Exiting dispatcher."},{"type":"NullLiteral"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"hasSearchQuery"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"UnaryExpression","operator":"typeof","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"q"}}},"operator":"!==","right":{"type":"StringLiteral","value":"string"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"debug"}},"arguments":[{"type":"StringLiteral","value":"search request has no search query"},{"type":"StringLiteral","value":"search.query.check"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":400}]}}],"directives":[]},"alternate":null},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"verifyToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]},"operator":"||","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"isSimpleAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"token"},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"BinaryExpression","left":{"type":"Identifier","name":"token"},"operator":"==","right":{"type":"NullLiteral"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"StringLiteral","value":"cannot auth token"},{"type":"StringLiteral","value":"token.verify.unset"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"payload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"verifyEncryptedAuthToken"}},"arguments":[{"type":"Identifier","name":"token"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"payload"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"message"}},{"type":"StringLiteral","value":"token.verify.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":401}]}},{"type":"ReturnStatement","argument":null}],"directives":[]}},"finalizer":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProviderReq"},"arguments":[{"type":"Identifier","name":"req"}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"key"},"init":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"key"},"optional":true}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"Identifier","name":"key"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"unconfigured credentials for ","cooked":"unconfigured credentials for "},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]},{"type":"StringLiteral","value":"non.oauth.token.load.unset"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"sendStatus"}},"arguments":[{"type":"NumericLiteral","value":501}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"accessToken"},"computed":false,"shorthand":false,"value":{"type":"Identifier","name":"key"}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]},"alternate":null}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"gentleVerifyToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerName"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"params"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},"consequent":{"type":"BlockStatement","body":[{"type":"TryStatement","block":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"payload"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"tokenService"},"computed":false,"property":{"type":"Identifier","name":"verifyEncryptedAuthToken"}},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerUserSession"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"payload"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}}],"directives":[]},"handler":{"type":"CatchClause","param":{"type":"Identifier","name":"err"},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"error"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"err"},"computed":false,"property":{"type":"Identifier","name":"message"}},{"type":"StringLiteral","value":"token.gentle.verify.error"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}}],"directives":[]}},"finalizer":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"cookieAuthToken"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"authToken"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"cookies"}},"computed":true,"property":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"computed":false,"property":{"type":"Identifier","name":"oauthProvider"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"uppyAuthToken--","cooked":"uppyAuthToken--"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"cors"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"Identifier","name":"options"},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingExposeHeaders"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Expose-Headers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"exposeHeadersSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"existingExposeHeaders"},"computed":false,"property":{"type":"Identifier","name":"split"},"optional":true},"optional":false,"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"},"optional":true},"optional":false,"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toLowerCase"}},"arguments":[]}}]}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"sendSelfEndpoint"}},"consequent":{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"exposeHeadersSet"},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"i-am"}]}},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowedHeaders"},"init":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"uppy-auth-token"},{"type":"StringLiteral","value":"uppy-credentials-params"},{"type":"StringLiteral","value":"authorization"},{"type":"StringLiteral","value":"origin"},{"type":"StringLiteral","value":"content-type"},{"type":"StringLiteral","value":"accept"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingAllowHeaders"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Allow-Headers"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowHeadersSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"ConditionalExpression","test":{"type":"Identifier","name":"existingAllowHeaders"},"consequent":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"existingAllowHeaders"},"computed":false,"property":{"type":"Identifier","name":"split"}},"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toLowerCase"}},"arguments":[]}}]},"computed":false,"property":{"type":"Identifier","name":"concat"}},"arguments":[{"type":"Identifier","name":"allowedHeaders"}]},"alternate":{"type":"Identifier","name":"allowedHeaders"}}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"existingAllowMethods"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"res"},"computed":false,"property":{"type":"Identifier","name":"get"}},"arguments":[{"type":"StringLiteral","value":"Access-Control-Allow-Methods"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"allowMethodsSet"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"Set"},"arguments":[{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"OptionalCallExpression","callee":{"type":"OptionalMemberExpression","object":{"type":"Identifier","name":"existingAllowMethods"},"computed":false,"property":{"type":"Identifier","name":"split"},"optional":true},"optional":false,"arguments":[{"type":"StringLiteral","value":","}]},"computed":false,"property":{"type":"Identifier","name":"map"},"optional":true},"optional":false,"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"method"}],"body":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"method"},"computed":false,"property":{"type":"Identifier","name":"trim"}},"arguments":[]},"computed":false,"property":{"type":"Identifier","name":"toUpperCase"}},"arguments":[]}}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"allowMethodsSet"},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"GET"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"POST"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"OPTIONS"}]},"computed":false,"property":{"type":"Identifier","name":"add"}},"arguments":[{"type":"StringLiteral","value":"DELETE"}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"corsOrigins"},"computed":false,"method":false,"shorthand":false,"value":{"type":"AssignmentPattern","left":{"type":"Identifier","name":"origin"},"right":{"type":"BooleanLiteral","value":true}}}]},"init":{"type":"Identifier","name":"options"}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"cors"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"credentials"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"origin"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"origin"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"methods"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"allowMethodsSet"}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"allowedHeaders"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"allowHeadersSet"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":","}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"exposedHeaders"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Array"},"computed":false,"property":{"type":"Identifier","name":"from"}},"arguments":[{"type":"Identifier","name":"exposeHeadersSet"}]},"computed":false,"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"StringLiteral","value":","}]}}]}]},"arguments":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}]}}],"directives":[]}}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"metrics"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"AssignmentPattern","left":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":true,"value":{"type":"AssignmentPattern","left":{"type":"Identifier","name":"path"},"right":{"type":"Identifier","name":"undefined"}}}]},"right":{"type":"ObjectExpression","properties":[]}}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"metricsMiddleware"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"promBundle"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"includeMethod"},"computed":false,"shorthand":false,"value":{"type":"BooleanLiteral","value":true}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"metricsPath"},"computed":false,"shorthand":false,"value":{"type":"ConditionalExpression","test":{"type":"Identifier","name":"path"},"consequent":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"path"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"/metrics","cooked":"/metrics"},"tail":true}]},"alternate":{"type":"Identifier","name":"undefined"}}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"promClient"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"promClient"}}]},"init":{"type":"Identifier","name":"metricsMiddleware"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"collectDefaultMetrics"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"collectDefaultMetrics"}}]},"init":{"type":"Identifier","name":"promClient"}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"collectDefaultMetrics"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"register"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"promClient"},"computed":false,"property":{"type":"Identifier","name":"register"}}}]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"versionGauge"},"init":{"type":"NewExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"promClient"},"computed":false,"property":{"type":"Identifier","name":"Gauge"}},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"name"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"companion_version"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"help"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"npm version as an integer"}}]}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"numberVersion"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"Number"},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"version"},"computed":false,"property":{"type":"Identifier","name":"replace"}},"arguments":[{"type":"RegExpLiteral","pattern":"\\D","flags":"g"},{"type":"StringLiteral","value":""}]}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"versionGauge"},"computed":false,"property":{"type":"Identifier","name":"set"}},"arguments":[{"type":"Identifier","name":"numberVersion"}]}},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"metricsMiddleware"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"getCompanionMiddleware"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"options"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middleware"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"options"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"options"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"s3Client"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getS3Client"},"arguments":[{"type":"Identifier","name":"options"},{"type":"BooleanLiteral","value":false}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"s3ClientCreatePresignedPost"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getS3Client"},"arguments":[{"type":"Identifier","name":"options"},{"type":"BooleanLiteral","value":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"authToken"},"computed":false,"shorthand":false,"value":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"header"}},"arguments":[{"type":"StringLiteral","value":"uppy-auth-token"}]},"operator":"||","right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"query"}},"computed":false,"property":{"type":"Identifier","name":"uppyAuthToken"}}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"buildURL"},"computed":false,"shorthand":false,"value":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"options"}]}}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"middleware"}}],"directives":[]}}}}],"directives":[]}},"packages/@uppy/companion/src/server/provider/index.js":{"type":"File","errors":[],"program":{"type":"Program","sourceType":"script","interpreter":null,"body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"dropbox"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./dropbox"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"box"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./box"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"drive"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./google/drive"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"googlephotos"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./google/googlephotos"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"instagram"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./instagram/graph"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"facebook"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./facebook"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"onedrive"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./onedrive"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"unsplash"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./unsplash"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"zoom"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./zoom"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getURLBuilder"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getURLBuilder"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../helpers/utils"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"logger"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"../logger"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"getCredentialsResolver"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"getCredentialsResolver"}}]},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./credentials"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"Provider"},"init":{"type":"CallExpression","callee":{"type":"Identifier","name":"require"},"arguments":[{"type":"StringLiteral","value":"./Provider"}]}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"isOAuthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"isOAuthProvider"}}]},"init":{"type":"Identifier","name":"Provider"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"validOptions"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"options"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"LogicalExpression","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"host"}},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"options"},"computed":false,"property":{"type":"Identifier","name":"server"}},"computed":false,"property":{"type":"Identifier","name":"protocol"}}}}],"directives":[]}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"getProviderMiddleware"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"middleware"},"init":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"req"},{"type":"Identifier","name":"res"},{"type":"Identifier","name":"next"},{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"ProviderClass"},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"Identifier","name":"ProviderClass"},"operator":"&&","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"validOptions"},"arguments":[{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}]}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"allowLocalUrls"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"allowLocalUrls"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthProvider"}}]},"init":{"type":"Identifier","name":"ProviderClass"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providerGrantConfig"},"init":null}],"kind":"let"},{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"getProviderCredentials"}},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"getCredentialsResolver"},"arguments":[{"type":"Identifier","name":"providerName"},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"options"}},{"type":"Identifier","name":"req"}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"providerGrantConfig"},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerGrantConfig"}},"right":{"type":"Identifier","name":"providerGrantConfig"}}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"secret"},"init":{"type":"OptionalMemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"secret"},"optional":true}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"provider"}},"right":{"type":"NewExpression","callee":{"type":"Identifier","name":"ProviderClass"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"secret"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"secret"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"providerName"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"providerName"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"providerGrantConfig"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"providerGrantConfig"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"allowLocalUrls"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"allowLocalUrls"}}]}]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"companion"}},"computed":false,"property":{"type":"Identifier","name":"providerClass"}},"right":{"type":"Identifier","name":"ProviderClass"}}}],"directives":[]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"invalid provider options detected. Provider will not be loaded"},{"type":"StringLiteral","value":"provider.middleware.invalid"},{"type":"MemberExpression","object":{"type":"Identifier","name":"req"},"computed":false,"property":{"type":"Identifier","name":"id"}}]}}],"directives":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"Identifier","name":"next"},"arguments":[]}}],"directives":[]}}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"middleware"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"providers"},"init":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"dropbox"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"dropbox"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"box"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"box"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"drive"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"drive"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"googlephotos"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"googlephotos"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"facebook"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"facebook"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"onedrive"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"onedrive"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"zoom"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"zoom"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"instagram"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"instagram"}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"unsplash"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"unsplash"}}]}}],"kind":"const"},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"providers"}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"addCustomProviders"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"customProviders"},{"type":"Identifier","name":"providers"},{"type":"Identifier","name":"grantConfig"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"Identifier","name":"customProviders"}]},"computed":false,"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"customProvider"},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProviders"},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"providers"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"right":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"module"}}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthProvider"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthProvider"}}]},"init":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"module"}}}],"kind":"const"},{"type":"IfStatement","test":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"right":{"type":"ObjectExpression","properties":[{"type":"SpreadElement","argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"customProvider"},"computed":false,"property":{"type":"Identifier","name":"config"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"callback"},"computed":false,"shorthand":false,"value":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","value":{"raw":"/callback","cooked":"/callback"},"tail":true}]}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"transport"},"computed":false,"shorthand":false,"value":{"type":"StringLiteral","value":"session"}}]}}}],"directives":[]},"alternate":null}],"directives":[]}}]}}],"directives":[]}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"module"},"computed":false,"property":{"type":"Identifier","name":"exports"}},"computed":false,"property":{"type":"Identifier","name":"addProviderOptions"}},"right":{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"companionOptions"},{"type":"Identifier","name":"grantConfig"},{"type":"Identifier","name":"getOauthProvider"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"server"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"server"}},{"type":"ObjectProperty","key":{"type":"Identifier","name":"providerOptions"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"providerOptions"}}]},"init":{"type":"Identifier","name":"companionOptions"}}],"kind":"const"},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"CallExpression","callee":{"type":"Identifier","name":"validOptions"},"arguments":[{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"server"},"computed":false,"shorthand":true,"value":{"type":"Identifier","name":"server"}}]}]}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"logger"},"computed":false,"property":{"type":"Identifier","name":"warn"}},"arguments":[{"type":"StringLiteral","value":"invalid provider options detected. Providers will not be loaded"},{"type":"StringLiteral","value":"provider.options.invalid"}]}},{"type":"ReturnStatement","argument":null}],"directives":[]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":false,"property":{"type":"Identifier","name":"defaults"}},"right":{"type":"ObjectExpression","properties":[{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"host"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"host"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"protocol"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"protocol"}}},{"type":"ObjectProperty","method":false,"key":{"type":"Identifier","name":"path"},"computed":false,"shorthand":false,"value":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}}}]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"ObjectPattern","properties":[{"type":"ObjectProperty","key":{"type":"Identifier","name":"oauthDomain"},"computed":false,"method":false,"shorthand":true,"value":{"type":"Identifier","name":"oauthDomain"}}]},"init":{"type":"Identifier","name":"server"}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"keys"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"keys"}},"arguments":[{"type":"Identifier","name":"providerOptions"}]},"computed":false,"property":{"type":"Identifier","name":"filter"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"key"}],"body":{"type":"BinaryExpression","left":{"type":"Identifier","name":"key"},"operator":"!==","right":{"type":"StringLiteral","value":"server"}}}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"keys"},"computed":false,"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"ArrowFunctionExpression","id":null,"generator":false,"async":false,"params":[{"type":"Identifier","name":"providerName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"oauthProvider"},"init":{"type":"OptionalCallExpression","callee":{"type":"Identifier","name":"getOauthProvider"},"optional":true,"arguments":[{"type":"Identifier","name":"providerName"}]}}],"kind":"const"},{"type":"IfStatement","test":{"type":"LogicalExpression","left":{"type":"CallExpression","callee":{"type":"Identifier","name":"isOAuthProvider"},"arguments":[{"type":"Identifier","name":"oauthProvider"}]},"operator":"&&","right":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"key"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"key"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"secret"}},"right":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"secret"}}}},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"providerOptions"},"computed":true,"property":{"type":"Identifier","name":"providerName"}},"computed":false,"property":{"type":"Identifier","name":"credentialsURL"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"dynamic"}},"right":{"type":"ArrayExpression","elements":[{"type":"StringLiteral","value":"key"},{"type":"StringLiteral","value":"secret"},{"type":"StringLiteral","value":"redirect_uri"}]}}}],"directives":[]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"provider"},"init":{"type":"MemberExpression","object":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"exports"},"computed":false,"property":{"type":"Identifier","name":"getDefaultProviders"}},"arguments":[]},"computed":true,"property":{"type":"Identifier","name":"providerName"}}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"Object"},"computed":false,"property":{"type":"Identifier","name":"assign"}},"arguments":[{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},{"type":"CallExpression","callee":{"type":"MemberExpression","object":{"type":"Identifier","name":"provider"},"computed":false,"property":{"type":"Identifier","name":"getExtraGrantConfig"}},"arguments":[]}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"isExternal"},"init":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"UnaryExpression","operator":"!","prefix":true,"argument":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}}}}}],"kind":"const"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"redirectPath"},"init":{"type":"TemplateLiteral","expressions":[{"type":"Identifier","name":"providerName"}],"quasis":[{"type":"TemplateElement","value":{"raw":"/","cooked":"/"},"tail":false},{"type":"TemplateElement","value":{"raw":"/redirect","cooked":"/redirect"},"tail":true}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"}},"right":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"companionOptions"}]},"arguments":[{"type":"Identifier","name":"redirectPath"},{"type":"Identifier","name":"isExternal"}]}}},{"type":"IfStatement","test":{"type":"Identifier","name":"oauthDomain"},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fullRedirectPath"},"init":{"type":"CallExpression","callee":{"type":"CallExpression","callee":{"type":"Identifier","name":"getURLBuilder"},"arguments":[{"type":"Identifier","name":"companionOptions"}]},"arguments":[{"type":"Identifier","name":"redirectPath"},{"type":"Identifier","name":"isExternal"},{"type":"BooleanLiteral","value":true}]}}],"kind":"const"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"redirect_uri"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"protocol"}},{"type":"Identifier","name":"oauthDomain"},{"type":"Identifier","name":"fullRedirectPath"}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"://","cooked":"://"},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":null},{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"implicitPath"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":{"type":"IfStatement","test":{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}},"right":{"type":"TemplateLiteral","expressions":[{"type":"MemberExpression","object":{"type":"Identifier","name":"server"},"computed":false,"property":{"type":"Identifier","name":"path"}},{"type":"MemberExpression","object":{"type":"MemberExpression","object":{"type":"Identifier","name":"grantConfig"},"computed":true,"property":{"type":"Identifier","name":"oauthProvider"}},"computed":false,"property":{"type":"Identifier","name":"callback"}}],"quasis":[{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":false},{"type":"TemplateElement","value":{"raw":"","cooked":""},"tail":true}]}}}],"directives":[]},"alternate":null}}],"directives":[]},"alternate":null}],"directives":[]}}]}}],"directives":[]}}}}],"directives":[]}}}},"renamedFiles":{"mappings":[],"before":{},"after":{}}}